function rr(t,e){if(!{}.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var to=0;function ii(t){return"__private_"+to+++"_"+t}function ro(t,e,r){const n=[];return t.forEach(i=>typeof i!="string"?n.push(i):e[Symbol.split](i).forEach((o,s,a)=>{o!==""&&n.push(o),s<a.length-1&&n.push(r)})),n}/**
 * Takes a string with placeholder variables like `%{smart_count} file selected`
 * and replaces it with values from options `{smart_count: 5}`
 *
 * @license https://github.com/airbnb/polyglot.js/blob/master/LICENSE
 * taken from https://github.com/airbnb/polyglot.js/blob/master/lib/polyglot.js#L299
 *
 * @param phrase that needs interpolation, with placeholders
 * @param options with values that will be used to replace placeholders
 */function hn(t,e){const r=/\$/g,n="$$$$";let i=[t];if(e==null)return i;for(const o of Object.keys(e))if(o!=="_"){let s=e[o];typeof s=="string"&&(s=r[Symbol.replace](s,n)),i=ro(i,new RegExp(`%\\{${o}\\}`,"g"),s)}return i}const no=t=>{throw new Error(`missing string: ${t}`)};var ht=ii("onMissingKey"),mt=ii("apply");class oi{constructor(e,r){let{onMissingKey:n=no}=r===void 0?{}:r;Object.defineProperty(this,mt,{value:io}),Object.defineProperty(this,ht,{writable:!0,value:void 0}),this.locale={strings:{},pluralize(i){return i===1?0:1}},Array.isArray(e)?e.forEach(rr(this,mt)[mt],this):rr(this,mt)[mt](e),rr(this,ht)[ht]=n}translate(e,r){return this.translateArray(e,r).join("")}translateArray(e,r){let n=this.locale.strings[e];if(n==null&&(rr(this,ht)[ht](e),n=e),typeof n=="object"){if(r&&typeof r.smart_count<"u"){const o=this.locale.pluralize(r.smart_count);return hn(n[o],r)}throw new Error("Attempted to use a string with plural forms, but no value was given for %{smart_count}")}if(typeof n!="string")throw new Error("string was not a string");return hn(n,r)}}function io(t){if(!(t!=null&&t.strings))return;const e=this.locale;Object.assign(this.locale,{strings:{...e.strings,...t.strings},pluralize:t.pluralize||e.pluralize})}var st=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var oo=function(){var e={},r=e._fns={};e.emit=function(s,a,l,c,f,p,v){var w=n(s);w.length&&i(s,w,[a,l,c,f,p,v])},e.on=function(s,a){r[s]||(r[s]=[]),r[s].push(a)},e.once=function(s,a){function l(){a.apply(this,arguments),e.off(s,l)}this.on(s,l)},e.off=function(s,a){var l=[];if(s&&a){var c=this._fns[s],f=0,p=c?c.length:0;for(f;f<p;f++)c[f]!==a&&l.push(c[f])}l.length?this._fns[s]=l:delete this._fns[s]};function n(o){var s=r[o]?r[o]:[],a=o.indexOf(":"),l=a===-1?[o]:[o.substring(0,a),o.substring(a+1)],c=Object.keys(r),f=0,p=c.length;for(f;f<p;f++){var v=c[f];if(v==="*"&&(s=s.concat(r[v])),l.length===2&&l[0]===v){s=s.concat(r[v]);break}}return s}function i(o,s,a){var l=0,c=s.length;for(l;l<c&&s[l];l++)s[l].event=o,s[l].apply(s[l],a)}return e};const so=dt(oo);let ao="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",lo=(t=21)=>{let e="",r=t;for(;r--;)e+=ao[Math.random()*64|0];return e};function uo(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var rn=uo,co=typeof st=="object"&&st&&st.Object===Object&&st,po=co,fo=po,ho=typeof self=="object"&&self&&self.Object===Object&&self,mo=fo||ho||Function("return this")(),si=mo,go=si,yo=function(){return go.Date.now()},vo=yo,bo=/\s/;function wo(t){for(var e=t.length;e--&&bo.test(t.charAt(e)););return e}var _o=wo,So=_o,Po=/^\s+/;function Uo(t){return t&&t.slice(0,So(t)+1).replace(Po,"")}var Eo=Uo,Oo=si,Fo=Oo.Symbol,ai=Fo,mn=ai,li=Object.prototype,xo=li.hasOwnProperty,Ro=li.toString,gt=mn?mn.toStringTag:void 0;function To(t){var e=xo.call(t,gt),r=t[gt];try{t[gt]=void 0;var n=!0}catch{}var i=Ro.call(t);return n&&(e?t[gt]=r:delete t[gt]),i}var $o=To,Co=Object.prototype,jo=Co.toString;function ko(t){return jo.call(t)}var Ao=ko,gn=ai,Lo=$o,Io=Ao,Mo="[object Null]",qo="[object Undefined]",yn=gn?gn.toStringTag:void 0;function No(t){return t==null?t===void 0?qo:Mo:yn&&yn in Object(t)?Lo(t):Io(t)}var zo=No;function Bo(t){return t!=null&&typeof t=="object"}var Ho=Bo,Do=zo,Go=Ho,Ko="[object Symbol]";function Wo(t){return typeof t=="symbol"||Go(t)&&Do(t)==Ko}var Xo=Wo,Vo=Eo,vn=rn,Yo=Xo,bn=0/0,Jo=/^[-+]0x[0-9a-f]+$/i,Qo=/^0b[01]+$/i,Zo=/^0o[0-7]+$/i,es=parseInt;function ts(t){if(typeof t=="number")return t;if(Yo(t))return bn;if(vn(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=vn(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Vo(t);var r=Qo.test(t);return r||Zo.test(t)?es(t.slice(2),r?2:8):Jo.test(t)?bn:+t}var rs=ts,ns=rn,vr=vo,wn=rs,is="Expected a function",os=Math.max,ss=Math.min;function as(t,e,r){var n,i,o,s,a,l,c=0,f=!1,p=!1,v=!0;if(typeof t!="function")throw new TypeError(is);e=wn(e)||0,ns(r)&&(f=!!r.leading,p="maxWait"in r,o=p?os(wn(r.maxWait)||0,e):o,v="trailing"in r?!!r.trailing:v);function w(C){var R=n,I=i;return n=i=void 0,c=C,s=t.apply(I,R),s}function U(C){return c=C,a=setTimeout(P,e),f?w(C):s}function O(C){var R=C-l,I=C-c,q=e-R;return p?ss(q,o-I):q}function b(C){var R=C-l,I=C-c;return l===void 0||R>=e||R<0||p&&I>=o}function P(){var C=vr();if(b(C))return x(C);a=setTimeout(P,O(C))}function x(C){return a=void 0,v&&n?w(C):(n=i=void 0,s)}function j(){a!==void 0&&clearTimeout(a),c=0,n=l=i=a=void 0}function k(){return a===void 0?s:x(vr())}function N(){var C=vr(),R=b(C);if(n=arguments,i=this,l=C,R){if(a===void 0)return U(l);if(p)return clearTimeout(a),a=setTimeout(P,e),w(l)}return a===void 0&&(a=setTimeout(P,e)),s}return N.cancel=j,N.flush=k,N}var ls=as,us=ls,cs=rn,ds="Expected a function";function ps(t,e,r){var n=!0,i=!0;if(typeof t!="function")throw new TypeError(ds);return cs(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),us(t,e,{leading:n,maxWait:e,trailing:i})}var fs=ps;const ui=dt(fs);function ar(t,e){if(!{}.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var hs=0;function ci(t){return"__private_"+hs+++"_"+t}const ms={version:"4.1.0"};var He=ci("callbacks"),br=ci("publish");class di{constructor(){Object.defineProperty(this,br,{value:gs}),this.state={},Object.defineProperty(this,He,{writable:!0,value:new Set})}getState(){return this.state}setState(e){const r={...this.state},n={...this.state,...e};this.state=n,ar(this,br)[br](r,n,e)}subscribe(e){return ar(this,He)[He].add(e),()=>{ar(this,He)[He].delete(e)}}}function gs(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];ar(this,He)[He].forEach(n=>{n(...e)})}di.VERSION=ms.version;function pi(t){const e=t.lastIndexOf(".");return e===-1||e===t.length-1?{name:t,extension:void 0}:{name:t.slice(0,e),extension:t.slice(e+1)}}const _n={__proto__:null,md:"text/markdown",markdown:"text/markdown",mp4:"video/mp4",mp3:"audio/mp3",svg:"image/svg+xml",jpg:"image/jpeg",png:"image/png",webp:"image/webp",gif:"image/gif",heic:"image/heic",heif:"image/heif",yaml:"text/yaml",yml:"text/yaml",csv:"text/csv",tsv:"text/tab-separated-values",tab:"text/tab-separated-values",avi:"video/x-msvideo",mks:"video/x-matroska",mkv:"video/x-matroska",mov:"video/quicktime",dicom:"application/dicom",doc:"application/msword",docm:"application/vnd.ms-word.document.macroenabled.12",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dot:"application/msword",dotm:"application/vnd.ms-word.template.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",xla:"application/vnd.ms-excel",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlc:"application/vnd.ms-excel",xlf:"application/x-xliff+xml",xlm:"application/vnd.ms-excel",xls:"application/vnd.ms-excel",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlt:"application/vnd.ms-excel",xltm:"application/vnd.ms-excel.template.macroenabled.12",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlw:"application/vnd.ms-excel",txt:"text/plain",text:"text/plain",conf:"text/plain",log:"text/plain",pdf:"application/pdf",zip:"application/zip","7z":"application/x-7z-compressed",rar:"application/x-rar-compressed",tar:"application/x-tar",gz:"application/gzip",dmg:"application/x-apple-diskimage"};function fi(t){var e;if(t.type)return t.type;const r=t.name?(e=pi(t.name).extension)==null?void 0:e.toLowerCase():null;return r&&r in _n?_n[r]:"application/octet-stream"}function ys(t){return t.charCodeAt(0).toString(32)}function Sn(t){let e="";return t.replace(/[^A-Z0-9]/gi,r=>(e+=`-${ys(r)}`,"/"))+e}function vs(t,e){let r=e||"uppy";return typeof t.name=="string"&&(r+=`-${Sn(t.name.toLowerCase())}`),t.type!==void 0&&(r+=`-${t.type}`),t.meta&&typeof t.meta.relativePath=="string"&&(r+=`-${Sn(t.meta.relativePath.toLowerCase())}`),t.data.size!==void 0&&(r+=`-${t.data.size}`),t.data.lastModified!==void 0&&(r+=`-${t.data.lastModified}`),r}function bs(t){return!t.isRemote||!t.remote?!1:new Set(["box","dropbox","drive","facebook","unsplash"]).has(t.remote.provider)}function ws(t,e){if(bs(t))return t.id;const r=fi(t);return vs({...t,type:r},e)}function _s(t){if(t==null&&typeof navigator<"u"&&(t=navigator.userAgent),!t)return!0;const e=/Edge\/(\d+\.\d+)/.exec(t);if(!e)return!0;const n=e[1].split(".",2),i=parseInt(n[0],10),o=parseInt(n[1],10);return i<15||i===15&&o<15063||i>18||i===18&&o>=18218}function Ss(t,e){return e.name?e.name:t.split("/")[0]==="image"?`${t.split("/")[0]}.${t.split("/")[1]}`:"noname"}function wr(t){return t<10?`0${t}`:t.toString()}function lr(){const t=new Date,e=wr(t.getHours()),r=wr(t.getMinutes()),n=wr(t.getSeconds());return`${e}:${r}:${n}`}const Ps={debug:()=>{},warn:()=>{},error:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return console.error(`[Uppy] [${lr()}]`,...e)}},Us={debug:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return console.debug(`[Uppy] [${lr()}]`,...e)},warn:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return console.warn(`[Uppy] [${lr()}]`,...e)},error:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return console.error(`[Uppy] [${lr()}]`,...e)}};var Es=function(e){if(typeof e!="number"||Number.isNaN(e))throw new TypeError(`Expected a number, got ${typeof e}`);const r=e<0,n=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];if(r&&(e=-e),e<1)return`${(r?"-":"")+e} B`;const i=Math.min(Math.floor(Math.log(e)/Math.log(1024)),n.length-1);e=Number(e/1024**i);const o=n[i];return e>=10||e%1===0?`${(r?"-":"")+e.toFixed(0)} ${o}`:`${(r?"-":"")+e.toFixed(1)} ${o}`};const nr=dt(Es);function hi(t,e){this.text=t=t||"",this.hasWild=~t.indexOf("*"),this.separator=e,this.parts=t.split(e)}hi.prototype.match=function(t){var e=!0,r=this.parts,n,i=r.length,o;if(typeof t=="string"||t instanceof String)if(!this.hasWild&&this.text!=t)e=!1;else{for(o=(t||"").split(this.separator),n=0;e&&n<i;n++)r[n]!=="*"&&(n<o.length?e=r[n]===o[n]:e=!1);e=e&&o}else if(typeof t.splice=="function")for(e=[],n=t.length;n--;)this.match(t[n])&&(e[e.length]=t[n]);else if(typeof t=="object"){e={};for(var s in t)this.match(s)&&(e[s]=t[s])}return e};var Os=function(t,e,r){var n=new hi(t,r||/[\/\.]/);return typeof e<"u"?n.match(e):n},Fs=Os,xs=/[\/\+\.]/,Rs=function(t,e){function r(n){var i=Fs(n,t,xs);return i&&i.length>=2}return e?r(e.split(";")[0]):r};const Ts=dt(Rs),$s={maxFileSize:null,minFileSize:null,maxTotalFileSize:null,maxNumberOfFiles:null,minNumberOfFiles:null,allowedFileTypes:null,requiredMetaFields:[]};class ye extends Error{constructor(e,r){var n;super(e),this.isRestriction=!0,this.isUserFacing=(n=r==null?void 0:r.isUserFacing)!=null?n:!0,r!=null&&r.file&&(this.file=r.file)}}class Cs{constructor(e,r){this.getI18n=r,this.getOpts=()=>{var n;const i=e();if(((n=i.restrictions)==null?void 0:n.allowedFileTypes)!=null&&!Array.isArray(i.restrictions.allowedFileTypes))throw new TypeError("`restrictions.allowedFileTypes` must be an array");return i}}validateAggregateRestrictions(e,r){const{maxTotalFileSize:n,maxNumberOfFiles:i}=this.getOpts().restrictions;if(i&&e.filter(s=>!s.isGhost).length+r.length>i)throw new ye(`${this.getI18n()("youCanOnlyUploadX",{smart_count:i})}`);if(n){const o=[...e,...r].reduce((s,a)=>{var l;return s+((l=a.size)!=null?l:0)},0);if(o>n)throw new ye(this.getI18n()("aggregateExceedsSize",{sizeAllowed:nr(n),size:nr(o)}))}}validateSingleFile(e){const{maxFileSize:r,minFileSize:n,allowedFileTypes:i}=this.getOpts().restrictions;if(i&&!i.some(a=>a.includes("/")?e.type?Ts(e.type.replace(/;.*?$/,""),a):!1:a[0]==="."&&e.extension?e.extension.toLowerCase()===a.slice(1).toLowerCase():!1)){const a=i.join(", ");throw new ye(this.getI18n()("youCanOnlyUploadFileTypes",{types:a}),{file:e})}if(r&&e.size!=null&&e.size>r){var o;throw new ye(this.getI18n()("exceedsSize",{size:nr(r),file:(o=e.name)!=null?o:this.getI18n()("unnamed")}),{file:e})}if(n&&e.size!=null&&e.size<n)throw new ye(this.getI18n()("inferiorSize",{size:nr(n)}),{file:e})}validate(e,r){r.forEach(n=>{this.validateSingleFile(n)}),this.validateAggregateRestrictions(e,r)}validateMinNumberOfFiles(e){const{minNumberOfFiles:r}=this.getOpts().restrictions;if(r&&Object.keys(e).length<r)throw new ye(this.getI18n()("youHaveToAtLeastSelectX",{smart_count:r}))}getMissingRequiredMetaFields(e){var r;const n=new ye(this.getI18n()("missingRequiredMetaFieldOnFile",{fileName:(r=e.name)!=null?r:this.getI18n()("unnamed")})),{requiredMetaFields:i}=this.getOpts().restrictions,o=[];for(const s of i)(!Object.hasOwn(e.meta,s)||e.meta[s]==="")&&o.push(s);return{missingFields:o,error:n}}}const js={strings:{addBulkFilesFailed:{0:"Failed to add %{smart_count} file due to an internal error",1:"Failed to add %{smart_count} files due to internal errors"},youCanOnlyUploadX:{0:"You can only upload %{smart_count} file",1:"You can only upload %{smart_count} files"},youHaveToAtLeastSelectX:{0:"You have to select at least %{smart_count} file",1:"You have to select at least %{smart_count} files"},aggregateExceedsSize:"You selected %{size} of files, but maximum allowed size is %{sizeAllowed}",exceedsSize:"%{file} exceeds maximum allowed size of %{size}",missingRequiredMetaField:"Missing required meta fields",missingRequiredMetaFieldOnFile:"Missing required meta fields in %{fileName}",inferiorSize:"This file is smaller than the allowed size of %{size}",youCanOnlyUploadFileTypes:"You can only upload: %{types}",noMoreFilesAllowed:"Cannot add more files",noDuplicates:"Cannot add the duplicate file '%{fileName}', it already exists",companionError:"Connection with Companion failed",authAborted:"Authentication aborted",companionUnauthorizeHint:"To unauthorize to your %{provider} account, please go to %{url}",failedToUpload:"Failed to upload %{file}",noInternetConnection:"No Internet connection",connectedToInternet:"Connected to the Internet",noFilesFound:"You have no files or folders here",noSearchResults:"Unfortunately, there are no results for this search",selectX:{0:"Select %{smart_count}",1:"Select %{smart_count}"},allFilesFromFolderNamed:"All files from folder %{name}",openFolderNamed:"Open folder %{name}",cancel:"Cancel",logOut:"Log out",filter:"Filter",resetFilter:"Reset filter",loading:"Loading...",loadedXFiles:"Loaded %{numFiles} files",authenticateWithTitle:"Please authenticate with %{pluginName} to select files",authenticateWith:"Connect to %{pluginName}",signInWithGoogle:"Sign in with Google",searchImages:"Search for images",enterTextToSearch:"Enter text to search for images",search:"Search",resetSearch:"Reset search",emptyFolderAdded:"No files were added from empty folder",addedNumFiles:"Added %{numFiles} file(s)",folderAlreadyAdded:'The folder "%{folder}" was already added',folderAdded:{0:"Added %{smart_count} file from %{folder}",1:"Added %{smart_count} files from %{folder}"},additionalRestrictionsFailed:"%{count} additional restrictions were not fulfilled",unnamed:"Unnamed"}};function _(t,e){if(!{}.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var ks=0;function z(t){return"__private_"+ks+++"_"+t}const As={version:"4.2.0"},ir={totalProgress:0,allowNewUpload:!0,error:null,recoveredState:null};var G=z("plugins"),ie=z("restricter"),yt=z("storeUnsubscribe"),Pe=z("emitter"),De=z("preProcessors"),Ge=z("uploaders"),Ce=z("postProcessors"),fe=z("informAndEmit"),Kt=z("checkRequiredMetaFieldsOnFile"),_r=z("checkRequiredMetaFields"),vt=z("assertNewUploadAllowed"),Mr=z("transformFile"),bt=z("startIfAutoProceed"),wt=z("checkAndUpdateFileState"),Sr=z("addListeners"),ve=z("updateOnlineStatus"),_t=z("requestClientById"),Ue=z("createUpload"),Pr=z("getUpload"),Je=z("removeUpload"),Ee=z("runUpload");class hr{constructor(e){Object.defineProperty(this,Ee,{value:Ws}),Object.defineProperty(this,Je,{value:Ks}),Object.defineProperty(this,Pr,{value:Gs}),Object.defineProperty(this,Ue,{value:Ds}),Object.defineProperty(this,Sr,{value:Hs}),Object.defineProperty(this,wt,{value:Bs}),Object.defineProperty(this,bt,{value:zs}),Object.defineProperty(this,Mr,{value:Ns}),Object.defineProperty(this,vt,{value:qs}),Object.defineProperty(this,_r,{value:Ms}),Object.defineProperty(this,Kt,{value:Is}),Object.defineProperty(this,fe,{value:Ls}),Object.defineProperty(this,G,{writable:!0,value:Object.create(null)}),Object.defineProperty(this,ie,{writable:!0,value:void 0}),Object.defineProperty(this,yt,{writable:!0,value:void 0}),Object.defineProperty(this,Pe,{writable:!0,value:so()}),Object.defineProperty(this,De,{writable:!0,value:new Set}),Object.defineProperty(this,Ge,{writable:!0,value:new Set}),Object.defineProperty(this,Ce,{writable:!0,value:new Set}),this.scheduledAutoProceed=null,this.wasOffline=!1,this.calculateProgress=ui((i,o)=>{const s=this.getFile(i==null?void 0:i.id);if(i==null||!s){this.log(`Not setting progress for a file that has been removed: ${i==null?void 0:i.id}`);return}if(s.progress.percentage===100){this.log(`Not setting progress for a file that has been already uploaded: ${i.id}`);return}const a=Number.isFinite(o.bytesTotal)&&o.bytesTotal>0;this.setFileState(i.id,{progress:{...s.progress,bytesUploaded:o.bytesUploaded,bytesTotal:o.bytesTotal,percentage:a?Math.round(o.bytesUploaded/o.bytesTotal*100):0}}),this.calculateTotalProgress()},500,{leading:!0,trailing:!0}),Object.defineProperty(this,ve,{writable:!0,value:this.updateOnlineStatus.bind(this)}),Object.defineProperty(this,_t,{writable:!0,value:new Map}),this.defaultLocale=js;const r={id:"uppy",autoProceed:!1,allowMultipleUploadBatches:!0,debug:!1,restrictions:$s,meta:{},onBeforeFileAdded:(i,o)=>!Object.hasOwn(o,i.id),onBeforeUpload:i=>i,store:new di,logger:Ps,infoTimeout:5e3},n={...r,...e};this.opts={...n,restrictions:{...r.restrictions,...e&&e.restrictions}},e&&e.logger&&e.debug?this.log("You are using a custom `logger`, but also set `debug: true`, which uses built-in logger to output logs to console. Ignoring `debug: true` and using your custom `logger`.","warning"):e&&e.debug&&(this.opts.logger=Us),this.log(`Using Core v${hr.VERSION}`),this.i18nInit(),this.store=this.opts.store,this.setState({...ir,plugins:{},files:{},currentUploads:{},capabilities:{uploadProgress:_s(),individualCancellation:!0,resumableUploads:!1},meta:{...this.opts.meta},info:[]}),_(this,ie)[ie]=new Cs(()=>this.opts,()=>this.i18n),_(this,yt)[yt]=this.store.subscribe((i,o,s)=>{this.emit("state-update",i,o,s),this.updateAll(o)}),this.opts.debug&&typeof window<"u"&&(window[this.opts.id]=this),_(this,Sr)[Sr]()}emit(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];_(this,Pe)[Pe].emit(e,...n)}on(e,r){return _(this,Pe)[Pe].on(e,r),this}once(e,r){return _(this,Pe)[Pe].once(e,r),this}off(e,r){return _(this,Pe)[Pe].off(e,r),this}updateAll(e){this.iteratePlugins(r=>{r.update(e)})}setState(e){this.store.setState(e)}getState(){return this.store.getState()}patchFilesState(e){const r=this.getState().files;this.setState({files:{...r,...Object.fromEntries(Object.entries(e).map(n=>{let[i,o]=n;return[i,{...r[i],...o}]}))}})}setFileState(e,r){if(!this.getState().files[e])throw new Error(`Can’t set state for ${e} (the file could have been removed)`);this.patchFilesState({[e]:r})}i18nInit(){const e=n=>this.log(`Missing i18n string: ${n}`,"error"),r=new oi([this.defaultLocale,this.opts.locale],{onMissingKey:e});this.i18n=r.translate.bind(r),this.i18nArray=r.translateArray.bind(r),this.locale=r.locale}setOptions(e){this.opts={...this.opts,...e,restrictions:{...this.opts.restrictions,...e==null?void 0:e.restrictions}},e.meta&&this.setMeta(e.meta),this.i18nInit(),e.locale&&this.iteratePlugins(r=>{r.setOptions(e)}),this.setState(void 0)}resetProgress(){const e={percentage:0,bytesUploaded:!1,uploadComplete:!1,uploadStarted:null},r={...this.getState().files},n=Object.create(null);Object.keys(r).forEach(i=>{n[i]={...r[i],progress:{...r[i].progress,...e}}}),this.setState({files:n,...ir})}clear(){const{capabilities:e,currentUploads:r}=this.getState();if(Object.keys(r).length>0&&!e.individualCancellation)throw new Error("The installed uploader plugin does not allow removing files during an upload.");this.setState({...ir,files:{}})}addPreProcessor(e){_(this,De)[De].add(e)}removePreProcessor(e){return _(this,De)[De].delete(e)}addPostProcessor(e){_(this,Ce)[Ce].add(e)}removePostProcessor(e){return _(this,Ce)[Ce].delete(e)}addUploader(e){_(this,Ge)[Ge].add(e)}removeUploader(e){return _(this,Ge)[Ge].delete(e)}setMeta(e){const r={...this.getState().meta,...e},n={...this.getState().files};Object.keys(n).forEach(i=>{n[i]={...n[i],meta:{...n[i].meta,...e}}}),this.log("Adding metadata:"),this.log(e),this.setState({meta:r,files:n})}setFileMeta(e,r){const n={...this.getState().files};if(!n[e]){this.log("Was trying to set metadata for a file that has been removed: ",e);return}const i={...n[e].meta,...r};n[e]={...n[e],meta:i},this.setState({files:n})}getFile(e){return this.getState().files[e]}getFiles(){const{files:e}=this.getState();return Object.values(e)}getFilesByIds(e){return e.map(r=>this.getFile(r))}getObjectOfFilesPerState(){const{files:e,totalProgress:r,error:n}=this.getState(),i=Object.values(e),o=[],s=[],a=[],l=[],c=[],f=[],p=[],v=[],w=[];for(const U of i){const{progress:O}=U;!O.uploadComplete&&O.uploadStarted&&(o.push(U),U.isPaused||v.push(U)),O.uploadStarted||s.push(U),(O.uploadStarted||O.preprocess||O.postprocess)&&a.push(U),O.uploadStarted&&l.push(U),U.isPaused&&c.push(U),O.uploadComplete&&f.push(U),U.error&&p.push(U),(O.preprocess||O.postprocess)&&w.push(U)}return{newFiles:s,startedFiles:a,uploadStartedFiles:l,pausedFiles:c,completeFiles:f,erroredFiles:p,inProgressFiles:o,inProgressNotPausedFiles:v,processingFiles:w,isUploadStarted:l.length>0,isAllComplete:r===100&&f.length===i.length&&w.length===0,isAllErrored:!!n&&p.length===i.length,isAllPaused:o.length!==0&&c.length===o.length,isUploadInProgress:o.length>0,isSomeGhost:i.some(U=>U.isGhost)}}validateSingleFile(e){try{_(this,ie)[ie].validateSingleFile(e)}catch(r){return r.message}return null}validateAggregateRestrictions(e){const r=this.getFiles();try{_(this,ie)[ie].validateAggregateRestrictions(r,e)}catch(n){return n.message}return null}checkIfFileAlreadyExists(e){const{files:r}=this.getState();return!!(r[e]&&!r[e].isGhost)}addFile(e){_(this,vt)[vt](e);const{nextFilesState:r,validFilesToAdd:n,errors:i}=_(this,wt)[wt]([e]),o=i.filter(a=>a.isRestriction);if(_(this,fe)[fe](o),i.length>0)throw i[0];this.setState({files:r});const[s]=n;return this.emit("file-added",s),this.emit("files-added",n),this.log(`Added file: ${s.name}, ${s.id}, mime type: ${s.type}`),_(this,bt)[bt](),s.id}addFiles(e){_(this,vt)[vt]();const{nextFilesState:r,validFilesToAdd:n,errors:i}=_(this,wt)[wt](e),o=i.filter(a=>a.isRestriction);_(this,fe)[fe](o);const s=i.filter(a=>!a.isRestriction);if(s.length>0){let a=`Multiple errors occurred while adding files:
`;if(s.forEach(l=>{a+=`
 * ${l.message}`}),this.info({message:this.i18n("addBulkFilesFailed",{smart_count:s.length}),details:a},"error",this.opts.infoTimeout),typeof AggregateError=="function")throw new AggregateError(s,a);{const l=new Error(a);throw l.errors=s,l}}this.setState({files:r}),n.forEach(a=>{this.emit("file-added",a)}),this.emit("files-added",n),n.length>5?this.log(`Added batch of ${n.length} files`):Object.values(n).forEach(a=>{this.log(`Added file: ${a.name}
 id: ${a.id}
 type: ${a.type}`)}),n.length>0&&_(this,bt)[bt]()}removeFiles(e){const{files:r,currentUploads:n}=this.getState(),i={...r},o={...n},s=Object.create(null);e.forEach(f=>{r[f]&&(s[f]=r[f],delete i[f])});function a(f){return s[f]===void 0}Object.keys(o).forEach(f=>{const p=n[f].fileIDs.filter(a);if(p.length===0){delete o[f];return}const{capabilities:v}=this.getState();if(p.length!==n[f].fileIDs.length&&!v.individualCancellation)throw new Error("The installed uploader plugin does not allow removing files during an upload.");o[f]={...n[f],fileIDs:p}});const l={currentUploads:o,files:i};Object.keys(i).length===0&&(l.allowNewUpload=!0,l.error=null,l.recoveredState=null),this.setState(l),this.calculateTotalProgress();const c=Object.keys(s);c.forEach(f=>{this.emit("file-removed",s[f])}),c.length>5?this.log(`Removed ${c.length} files`):this.log(`Removed files: ${c.join(", ")}`)}removeFile(e){this.removeFiles([e])}pauseResume(e){if(!this.getState().capabilities.resumableUploads||this.getFile(e).progress.uploadComplete)return;const r=this.getFile(e),i=!(r.isPaused||!1);return this.setFileState(e,{isPaused:i}),this.emit("upload-pause",r,i),i}pauseAll(){const e={...this.getState().files};Object.keys(e).filter(n=>!e[n].progress.uploadComplete&&e[n].progress.uploadStarted).forEach(n=>{const i={...e[n],isPaused:!0};e[n]=i}),this.setState({files:e}),this.emit("pause-all")}resumeAll(){const e={...this.getState().files};Object.keys(e).filter(n=>!e[n].progress.uploadComplete&&e[n].progress.uploadStarted).forEach(n=>{const i={...e[n],isPaused:!1,error:null};e[n]=i}),this.setState({files:e}),this.emit("resume-all")}retryAll(){const e={...this.getState().files},r=Object.keys(e).filter(i=>e[i].error);if(r.forEach(i=>{const o={...e[i],isPaused:!1,error:null};e[i]=o}),this.setState({files:e,error:null}),this.emit("retry-all",Object.values(e)),r.length===0)return Promise.resolve({successful:[],failed:[]});const n=_(this,Ue)[Ue](r,{forceAllowNewUpload:!0});return _(this,Ee)[Ee](n)}cancelAll(){this.emit("cancel-all");const{files:e}=this.getState(),r=Object.keys(e);r.length&&this.removeFiles(r),this.setState(ir)}retryUpload(e){this.setFileState(e,{error:null,isPaused:!1}),this.emit("upload-retry",this.getFile(e));const r=_(this,Ue)[Ue]([e],{forceAllowNewUpload:!0});return _(this,Ee)[Ee](r)}logout(){this.iteratePlugins(e=>{var r;(r=e.provider)==null||r.logout==null||r.logout()})}calculateTotalProgress(){const r=this.getFiles().filter(c=>c.progress.uploadStarted||c.progress.preprocess||c.progress.postprocess);if(r.length===0){this.emit("progress",0),this.setState({totalProgress:0});return}const n=r.filter(c=>c.progress.bytesTotal!=null),i=r.filter(c=>c.progress.bytesTotal==null);if(n.length===0){const c=r.length*100,f=i.reduce((v,w)=>v+w.progress.percentage,0),p=Math.round(f/c*100);this.setState({totalProgress:p});return}let o=n.reduce((c,f)=>{var p;return c+((p=f.progress.bytesTotal)!=null?p:0)},0);const s=o/n.length;o+=s*i.length;let a=0;n.forEach(c=>{a+=c.progress.bytesUploaded}),i.forEach(c=>{a+=s*(c.progress.percentage||0)/100});let l=o===0?0:Math.round(a/o*100);l>100&&(l=100),this.setState({totalProgress:l}),this.emit("progress",l)}updateOnlineStatus(){var e;((e=window.navigator.onLine)!=null?e:!0)?(this.emit("is-online"),this.wasOffline&&(this.emit("back-online"),this.info(this.i18n("connectedToInternet"),"success",3e3),this.wasOffline=!1)):(this.emit("is-offline"),this.info(this.i18n("noInternetConnection"),"error",0),this.wasOffline=!0)}getID(){return this.opts.id}use(e){if(typeof e!="function"){const l=`Expected a plugin class, but got ${e===null?"null":typeof e}. Please verify that the plugin was imported and spelled correctly.`;throw new TypeError(l)}for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];const o=new e(this,...n),s=o.id;if(!s)throw new Error("Your plugin must have an id");if(!o.type)throw new Error("Your plugin must have a type");const a=this.getPlugin(s);if(a){const l=`Already found a plugin named '${a.id}'. Tried to use: '${s}'.
Uppy plugins must have unique \`id\` options.`;throw new Error(l)}return e.VERSION&&this.log(`Using ${s} v${e.VERSION}`),o.type in _(this,G)[G]?_(this,G)[G][o.type].push(o):_(this,G)[G][o.type]=[o],o.install(),this.emit("plugin-added",o),this}getPlugin(e){for(const r of Object.values(_(this,G)[G])){const n=r.find(i=>i.id===e);if(n!=null)return n}}[Symbol.for("uppy test: getPlugins")](e){return _(this,G)[G][e]}iteratePlugins(e){Object.values(_(this,G)[G]).flat(1).forEach(e)}removePlugin(e){this.log(`Removing plugin ${e.id}`),this.emit("plugin-remove",e),e.uninstall&&e.uninstall();const r=_(this,G)[G][e.type],n=r.findIndex(s=>s.id===e.id);n!==-1&&r.splice(n,1);const o={plugins:{...this.getState().plugins,[e.id]:void 0}};this.setState(o)}destroy(){this.log(`Closing Uppy instance ${this.opts.id}: removing all files and uninstalling plugins`),this.cancelAll(),_(this,yt)[yt](),this.iteratePlugins(e=>{this.removePlugin(e)}),typeof window<"u"&&window.removeEventListener&&(window.removeEventListener("online",_(this,ve)[ve]),window.removeEventListener("offline",_(this,ve)[ve]))}hideInfo(){const{info:e}=this.getState();this.setState({info:e.slice(1)}),this.emit("info-hidden")}info(e,r,n){r===void 0&&(r="info"),n===void 0&&(n=3e3);const i=typeof e=="object";this.setState({info:[...this.getState().info,{type:r,message:i?e.message:e,details:i?e.details:null}]}),setTimeout(()=>this.hideInfo(),n),this.emit("info-visible")}log(e,r){const{logger:n}=this.opts;switch(r){case"error":n.error(e);break;case"warning":n.warn(e);break;default:n.debug(e);break}}registerRequestClient(e,r){_(this,_t)[_t].set(e,r)}getRequestClientForFile(e){if(!e.remote)throw new Error(`Tried to get RequestClient for a non-remote file ${e.id}`);const r=_(this,_t)[_t].get(e.remote.requestClientId);if(r==null)throw new Error(`requestClientId "${e.remote.requestClientId}" not registered for file "${e.id}"`);return r}restore(e){return this.log(`Core: attempting to restore upload "${e}"`),this.getState().currentUploads[e]?_(this,Ee)[Ee](e):(_(this,Je)[Je](e),Promise.reject(new Error("Nonexistent upload")))}[Symbol.for("uppy test: createUpload")](){return _(this,Ue)[Ue](...arguments)}addResultData(e,r){if(!_(this,Pr)[Pr](e)){this.log(`Not setting result for an upload that has been removed: ${e}`);return}const{currentUploads:n}=this.getState(),i={...n[e],result:{...n[e].result,...r}};this.setState({currentUploads:{...n,[e]:i}})}upload(){var e;(e=_(this,G)[G].uploader)!=null&&e.length||this.log("No uploader type plugins are used","warning");let{files:r}=this.getState();const n=this.opts.onBeforeUpload(r);return n===!1?Promise.reject(new Error("Not starting the upload because onBeforeUpload returned false")):(n&&typeof n=="object"&&(r=n,this.setState({files:r})),Promise.resolve().then(()=>_(this,ie)[ie].validateMinNumberOfFiles(r)).catch(i=>{throw _(this,fe)[fe]([i]),i}).then(()=>{if(!_(this,_r)[_r](r))throw new ye(this.i18n("missingRequiredMetaField"))}).catch(i=>{throw i}).then(()=>{const{currentUploads:i}=this.getState(),o=Object.values(i).flatMap(l=>l.fileIDs),s=[];Object.keys(r).forEach(l=>{const c=this.getFile(l);!c.progress.uploadStarted&&o.indexOf(l)===-1&&s.push(c.id)});const a=_(this,Ue)[Ue](s);return _(this,Ee)[Ee](a)}).catch(i=>{throw this.emit("error",i),this.log(i,"error"),i}))}}function Ls(t){for(const o of t)o.isRestriction?this.emit("restriction-failed",o.file,o):this.emit("error",o,o.file),this.log(o,"warning");const e=t.filter(o=>o.isUserFacing),r=4,n=e.slice(0,r),i=e.slice(r);n.forEach(o=>{let{message:s,details:a=""}=o;this.info({message:s,details:a},"error",this.opts.infoTimeout)}),i.length>0&&this.info({message:this.i18n("additionalRestrictionsFailed",{count:i.length})})}function Is(t){const{missingFields:e,error:r}=_(this,ie)[ie].getMissingRequiredMetaFields(t);return e.length>0?(this.setFileState(t.id,{missingRequiredMetaFields:e}),this.log(r.message),this.emit("restriction-failed",t,r),!1):!0}function Ms(t){let e=!0;for(const r of Object.values(t))_(this,Kt)[Kt](r)||(e=!1);return e}function qs(t){const{allowNewUpload:e}=this.getState();if(e===!1){const r=new ye(this.i18n("noMoreFilesAllowed"),{file:t});throw _(this,fe)[fe]([r]),r}}function Ns(t){const e=t instanceof File?{name:t.name,type:t.type,size:t.size,data:t}:t,r=fi(e),n=Ss(r,e),i=pi(n).extension,o=ws(e,this.getID()),s=e.meta||{};s.name=n,s.type=r;const a=Number.isFinite(e.data.size)?e.data.size:null;return{source:e.source||"",id:o,name:n,extension:i||"",meta:{...this.getState().meta,...s},type:r,data:e.data,progress:{percentage:0,bytesUploaded:!1,bytesTotal:a,uploadComplete:!1,uploadStarted:null},size:a,isGhost:!1,isRemote:e.isRemote||!1,remote:e.remote,preview:e.preview}}function zs(){this.opts.autoProceed&&!this.scheduledAutoProceed&&(this.scheduledAutoProceed=setTimeout(()=>{this.scheduledAutoProceed=null,this.upload().catch(t=>{t.isRestriction||this.log(t.stack||t.message||t)})},4))}function Bs(t){const{files:e}=this.getState(),r={...e},n=[],i=[];for(const a of t)try{var o;let l=_(this,Mr)[Mr](a);const c=(o=e[l.id])==null?void 0:o.isGhost;c&&(l={...e[l.id],isGhost:!1,data:a.data},this.log(`Replaced the blob in the restored ghost file: ${l.name}, ${l.id}`));const f=this.opts.onBeforeFileAdded(l,r);if(!f&&this.checkIfFileAlreadyExists(l.id)){var s;throw new ye(this.i18n("noDuplicates",{fileName:(s=l.name)!=null?s:this.i18n("unnamed")}),{file:a})}if(f===!1&&!c)throw new ye("Cannot add the file because onBeforeFileAdded returned false.",{isUserFacing:!1,file:a});typeof f=="object"&&f!==null&&(l=f),_(this,ie)[ie].validateSingleFile(l),r[l.id]=l,n.push(l)}catch(l){i.push(l)}try{_(this,ie)[ie].validateAggregateRestrictions(Object.values(e),n)}catch(a){return i.push(a),{nextFilesState:e,validFilesToAdd:[],errors:i}}return{nextFilesState:r,validFilesToAdd:n,errors:i}}function Hs(){const t=(n,i,o)=>{let s=n.message||"Unknown error";n.details&&(s+=` ${n.details}`),this.setState({error:s}),i!=null&&i.id in this.getState().files&&this.setFileState(i.id,{error:s,response:o})};this.on("error",t),this.on("upload-error",(n,i,o)=>{if(t(i,n,o),typeof i=="object"&&i.message){var s;this.log(i.message,"error");const a=new Error(this.i18n("failedToUpload",{file:(s=n==null?void 0:n.name)!=null?s:""}));a.isUserFacing=!0,a.details=i.message,i.details&&(a.details+=` ${i.details}`),_(this,fe)[fe]([a])}else _(this,fe)[fe]([i])});let e=null;this.on("upload-stalled",(n,i)=>{const{message:o}=n,s=i.map(a=>a.meta.name).join(", ");e||(this.info({message:o,details:s},"warning",this.opts.infoTimeout),e=setTimeout(()=>{e=null},this.opts.infoTimeout)),this.log(`${o} ${s}`.trim(),"warning")}),this.on("upload",()=>{this.setState({error:null})});const r=n=>{const i=n.filter(s=>{const a=s!=null&&this.getFile(s.id);return a||this.log(`Not setting progress for a file that has been removed: ${s==null?void 0:s.id}`),a}),o=Object.fromEntries(i.map(s=>[s.id,{progress:{uploadStarted:Date.now(),uploadComplete:!1,percentage:0,bytesUploaded:0,bytesTotal:s.size}}]));this.patchFilesState(o)};this.on("upload-start",r),this.on("upload-progress",this.calculateProgress),this.on("upload-success",(n,i)=>{if(n==null||!this.getFile(n.id)){this.log(`Not setting progress for a file that has been removed: ${n==null?void 0:n.id}`);return}const o=this.getFile(n.id).progress;this.setFileState(n.id,{progress:{...o,postprocess:_(this,Ce)[Ce].size>0?{mode:"indeterminate"}:void 0,uploadComplete:!0,percentage:100,bytesUploaded:o.bytesTotal},response:i,uploadURL:i.uploadURL,isPaused:!1}),n.size==null&&this.setFileState(n.id,{size:i.bytesUploaded||o.bytesTotal}),this.calculateTotalProgress()}),this.on("preprocess-progress",(n,i)=>{if(n==null||!this.getFile(n.id)){this.log(`Not setting progress for a file that has been removed: ${n==null?void 0:n.id}`);return}this.setFileState(n.id,{progress:{...this.getFile(n.id).progress,preprocess:i}})}),this.on("preprocess-complete",n=>{if(n==null||!this.getFile(n.id)){this.log(`Not setting progress for a file that has been removed: ${n==null?void 0:n.id}`);return}const i={...this.getState().files};i[n.id]={...i[n.id],progress:{...i[n.id].progress}},delete i[n.id].progress.preprocess,this.setState({files:i})}),this.on("postprocess-progress",(n,i)=>{if(n==null||!this.getFile(n.id)){this.log(`Not setting progress for a file that has been removed: ${n==null?void 0:n.id}`);return}this.setFileState(n.id,{progress:{...this.getState().files[n.id].progress,postprocess:i}})}),this.on("postprocess-complete",n=>{if(n==null||!this.getFile(n.id)){this.log(`Not setting progress for a file that has been removed: ${n==null?void 0:n.id}`);return}const i={...this.getState().files};i[n.id]={...i[n.id],progress:{...i[n.id].progress}},delete i[n.id].progress.postprocess,this.setState({files:i})}),this.on("restored",()=>{this.calculateTotalProgress()}),this.on("dashboard:file-edit-complete",n=>{n&&_(this,Kt)[Kt](n)}),typeof window<"u"&&window.addEventListener&&(window.addEventListener("online",_(this,ve)[ve]),window.addEventListener("offline",_(this,ve)[ve]),setTimeout(_(this,ve)[ve],3e3))}function Ds(t,e){e===void 0&&(e={});const{forceAllowNewUpload:r=!1}=e,{allowNewUpload:n,currentUploads:i}=this.getState();if(!n&&!r)throw new Error("Cannot create a new upload: already uploading.");const o=lo();return this.emit("upload",o,this.getFilesByIds(t)),this.setState({allowNewUpload:this.opts.allowMultipleUploadBatches!==!1&&this.opts.allowMultipleUploads!==!1,currentUploads:{...i,[o]:{fileIDs:t,step:0,result:{}}}}),o}function Gs(t){const{currentUploads:e}=this.getState();return e[t]}function Ks(t){const e={...this.getState().currentUploads};delete e[t],this.setState({currentUploads:e})}async function Ws(t){const e=()=>{const{currentUploads:o}=this.getState();return o[t]};let r=e();const n=[..._(this,De)[De],..._(this,Ge)[Ge],..._(this,Ce)[Ce]];try{for(let o=r.step||0;o<n.length&&r;o++){const s=n[o];this.setState({currentUploads:{...this.getState().currentUploads,[t]:{...r,step:o}}});const{fileIDs:a}=r;await s(a,t),r=e()}}catch(o){throw _(this,Je)[Je](t),o}if(r){r.fileIDs.forEach(l=>{const c=this.getFile(l);c&&c.progress.postprocess&&this.emit("postprocess-complete",c)});const o=r.fileIDs.map(l=>this.getFile(l)),s=o.filter(l=>!l.error),a=o.filter(l=>l.error);this.addResultData(t,{successful:s,failed:a,uploadID:t}),r=e()}let i;return r&&(i=r.result,this.emit("complete",i),_(this,Je)[Je](t)),i==null&&this.log(`Not setting result for an upload that has been removed: ${t}`),i}hr.VERSION=As.version;const Xs=hr;class mi{constructor(e,r){this.uppy=e,this.opts=r??{}}getPluginState(){const{plugins:e}=this.uppy.getState();return(e==null?void 0:e[this.id])||{}}setPluginState(e){const{plugins:r}=this.uppy.getState();this.uppy.setState({plugins:{...r,[this.id]:{...r[this.id],...e}}})}setOptions(e){this.opts={...this.opts,...e},this.setPluginState(void 0),this.i18nInit()}i18nInit(){const e=new oi([this.defaultLocale,this.uppy.locale,this.opts.locale]);this.i18n=e.translate.bind(e),this.i18nArray=e.translateArray.bind(e),this.setPluginState(void 0)}addTarget(e){throw new Error("Extend the addTarget method to add your plugin to another plugin's target")}install(){}uninstall(){}update(e){}afterUpdate(){}}class Vs extends Error{constructor(){super(...arguments),this.name="UserFacingApiError"}}var gi={};function me(t,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var Ys=me;me.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};me.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};me.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=new Date().getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},r),this._options.unref&&this._timer.unref(),!0};me.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};me.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)};me.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)};me.prototype.start=me.prototype.try;me.prototype.errors=function(){return this._errors};me.prototype.attempts=function(){return this._attempts};me.prototype.mainError=function(){if(this._errors.length===0)return null;for(var t={},e=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],o=i.message,s=(t[o]||0)+1;t[o]=s,s>=r&&(e=i,r=s)}return e};(function(t){var e=Ys;t.operation=function(r){var n=t.timeouts(r);return new e(n,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})},t.timeouts=function(r){if(r instanceof Array)return[].concat(r);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in r)n[i]=r[i];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var o=[],s=0;s<n.retries;s++)o.push(this.createTimeout(s,n));return r&&r.forever&&!o.length&&o.push(this.createTimeout(s,n)),o.sort(function(a,l){return a-l}),o},t.createTimeout=function(r,n){var i=n.randomize?Math.random()+1:1,o=Math.round(i*Math.max(n.minTimeout,1)*Math.pow(n.factor,r));return o=Math.min(o,n.maxTimeout),o},t.wrap=function(r,n,i){if(n instanceof Array&&(i=n,n=null),!i){i=[];for(var o in r)typeof r[o]=="function"&&i.push(o)}for(var s=0;s<i.length;s++){var a=i[s],l=r[a];r[a]=(function(f){var p=t.operation(n),v=Array.prototype.slice.call(arguments,1),w=v.pop();v.push(function(U){p.retry(U)||(U&&(arguments[0]=p.mainError()),w.apply(this,arguments))}),p.attempt(function(){f.apply(r,v)})}).bind(r,l),r[a].options=n}}})(gi);var Js=gi;const Qs=dt(Js),Zs=Object.prototype.toString,ea=t=>Zs.call(t)==="[object Error]",ta=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function ra(t){return t&&ea(t)&&t.name==="TypeError"&&typeof t.message=="string"?t.message==="Load failed"?t.stack===void 0:ta.has(t.message):!1}class qr extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const Pn=(t,e,r)=>{const n=r.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=n,t};async function yi(t,e){return new Promise((r,n)=>{e={onFailedAttempt(){},retries:10,shouldRetry:()=>!0,...e};const i=Qs.operation(e),o=()=>{var a;i.stop(),n((a=e.signal)==null?void 0:a.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",o,{once:!0});const s=()=>{var a;(a=e.signal)==null||a.removeEventListener("abort",o),i.stop()};i.attempt(async a=>{try{const l=await t(a);s(),r(l)}catch(l){try{if(!(l instanceof Error))throw new TypeError(`Non-error was thrown: "${l}". You should only throw errors.`);if(l instanceof qr)throw l.originalError;if(l instanceof TypeError&&!ra(l))throw l;if(Pn(l,a,e),await e.shouldRetry(l)||(i.stop(),n(l)),await e.onFailedAttempt(l),!i.retry(l))throw i.mainError()}catch(c){Pn(c,a,e),s(),n(c)}}})})}class vi extends Error{constructor(e,r){r===void 0&&(r=null),super("This looks like a network error, the endpoint might be blocked by an internet provider or a firewall."),this.cause=e,this.isNetworkError=!0,this.request=r}}function na(){return fetch(...arguments).catch(t=>{throw t.name==="AbortError"?t:new vi(t)})}function zt(t,e){return Object.prototype.hasOwnProperty.call(t,e)}class ia extends Error{constructor(e,r){super(e),this.cause=r==null?void 0:r.cause,this.cause&&zt(this.cause,"isNetworkError")?this.isNetworkError=this.cause.isNetworkError:this.isNetworkError=!1}}function oa(t,e,r){const{progress:n,bytesUploaded:i,bytesTotal:o}=e;if(n){var s;t.uppy.log(`Upload progress: ${n}`),t.uppy.emit("upload-progress",r,{uploadStarted:(s=r.progress.uploadStarted)!=null?s:0,bytesUploaded:i,bytesTotal:o})}}const sa=ui(oa,300,{leading:!0,trailing:!0});function aa(t){var e;const n=(e=/^(?:https?:\/\/|\/\/)?(?:[^@\n]+@)?(?:www\.)?([^\n]+)/i.exec(t))==null?void 0:e[1];return`${/^http:\/\//i.test(t)?"ws":"wss"}://${n}`}class la extends Error{constructor(){super("Authorization required"),this.name="AuthError",this.isAuthError=!0}}function Oe(t,e){if(!{}.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var ua=0;function mr(t){return"__private_"+ua+++"_"+t}const ca={version:"4.1.0"};function da(t){return t.replace(/\/$/,"")}const bi=10,pa=5*60*1e3,fa=401;class ha extends Error{constructor(e){let{statusCode:r,message:n}=e;super(n),this.name="HttpError",this.statusCode=r}}async function ma(t){if(t.status===fa)throw new la;if(t.ok)return t.json();let e=`Failed request with status: ${t.status}. ${t.statusText}`,r;try{r=await t.json(),r.message&&(e=`${e} message: ${r.message}`),r.requestId&&(e=`${e} request-Id: ${r.requestId}`)}catch(n){throw new Error(e,{cause:n})}throw t.status>=400&&t.status<=499&&r.message?new Vs(r.message):new ha({statusCode:t.status,message:e})}var Fe=mr("companionHeaders"),St=mr("getUrl"),Ur=mr("requestSocketToken"),Pt=mr("awaitRemoteFileUpload");class wi{constructor(e,r){Object.defineProperty(this,Pt,{value:ya}),Object.defineProperty(this,St,{value:ga}),Object.defineProperty(this,Fe,{writable:!0,value:void 0}),Object.defineProperty(this,Ur,{writable:!0,value:async n=>{var i;let{file:o,postBody:s,signal:a}=n;if(((i=o.remote)==null?void 0:i.url)==null)throw new Error("Cannot connect to an undefined URL");return(await this.post(o.remote.url,{...o.remote.body,...s},{signal:a})).token}}),this.uppy=e,this.opts=r,this.onReceiveResponse=this.onReceiveResponse.bind(this),Oe(this,Fe)[Fe]=r.companionHeaders}setCompanionHeaders(e){Oe(this,Fe)[Fe]=e}[Symbol.for("uppy test: getCompanionHeaders")](){return Oe(this,Fe)[Fe]}get hostname(){const{companion:e}=this.uppy.getState(),r=this.opts.companionUrl;return da(e&&e[r]?e[r]:r)}async headers(e){return e===void 0&&(e=!1),{...{Accept:"application/json",...e?void 0:{"Content-Type":"application/json"}},...Oe(this,Fe)[Fe]}}onReceiveResponse(e){const{headers:r}=e,i=this.uppy.getState().companion||{},o=this.opts.companionUrl;r.has("i-am")&&r.get("i-am")!==i[o]&&this.uppy.setState({companion:{...i,[o]:r.get("i-am")}})}async request(e){let{path:r,method:n="GET",data:i,skipPostResponse:o,signal:s}=e;try{const a=await this.headers(!i),l=await na(Oe(this,St)[St](r),{method:n,signal:s,headers:a,credentials:this.opts.companionCookiesRule||"same-origin",body:i?JSON.stringify(i):null});return o||this.onReceiveResponse(l),await ma(l)}catch(a){throw a.isAuthError||a.name==="UserFacingApiError"||a.name==="AbortError"?a:new ia(`Could not ${n} ${Oe(this,St)[St](r)}`,{cause:a})}}async get(e,r){return this.request({...r,path:e})}async post(e,r,n){return this.request({...n,path:e,method:"POST",data:r})}async delete(e,r,n){return this.request({...n,path:e,method:"DELETE",data:r})}async uploadRemoteFile(e,r,n){var i=this;try{const{signal:o,getQueue:s}=n||{};return await yi(async()=>{var a;const l=(a=this.uppy.getFile(e.id))==null?void 0:a.serverToken;if(l!=null)return this.uppy.log(`Connecting to exiting websocket ${l}`),Oe(this,Pt)[Pt]({file:e,queue:s(),signal:o});const f=await s().wrapPromiseFunction(async function(){try{return await Oe(i,Ur)[Ur](...arguments)}catch(p){if(p.isAuthError)throw new qr(p);if(p.cause==null)throw p;const v=p.cause,w=()=>[408,409,429,418,423].includes(v.statusCode)||v.statusCode>=500&&v.statusCode<=599&&![501,505].includes(v.statusCode);throw v.name==="HttpError"&&!w()?new qr(v):v}},{priority:-1})({file:e,postBody:r,signal:o}).abortOn(o);if(this.uppy.getFile(e.id))return this.uppy.setFileState(e.id,{serverToken:f}),Oe(this,Pt)[Pt]({file:this.uppy.getFile(e.id),queue:s(),signal:o})},{retries:bi,signal:o,onFailedAttempt:a=>this.uppy.log(`Retrying upload due to: ${a.message}`,"warning")})}catch(o){if(o.name==="AbortError")return;throw this.uppy.emit("upload-error",e,o),o}}}function ga(t){return/^(https?:|)\/\//.test(t)?t:`${this.hostname}/${t}`}async function ya(t){let{file:e,queue:r,signal:n}=t,i;const{capabilities:o}=this.uppy.getState();try{return await new Promise((s,a)=>{const l=e.serverToken,c=aa(e.remote.companionUrl);let f,p,v,{isPaused:w}=e;const U=(R,I)=>{if(f==null||f.readyState!==f.OPEN){var q;this.uppy.log(`Cannot send "${R}" to socket ${e.id} because the socket state was ${String((q=f)==null?void 0:q.readyState)}`,"warning");return}f.send(JSON.stringify({action:R,payload:I??{}}))};function O(){o.resumableUploads&&U(w?"pause":"resume")}const b=async()=>{p&&p.abort(),p=new AbortController;const R=q=>{var be;this.uppy.setFileState(e.id,{serverToken:null}),(be=p)==null||be.abort==null||be.abort(),a(q)};function I(){clearTimeout(v),!w&&(v=setTimeout(()=>R(new Error("Timeout waiting for message from Companion socket")),pa))}try{await r.wrapPromiseFunction(async()=>{await yi(async()=>new Promise((be,ke)=>{f=new WebSocket(`${c}/api/${l}`),I(),f.addEventListener("close",()=>{f=void 0,ke(new Error("Socket closed unexpectedly"))}),f.addEventListener("error",ge=>{var ue;this.uppy.log(`Companion socket error ${JSON.stringify(ge)}, closing socket`,"warning"),(ue=f)==null||ue.close()}),f.addEventListener("open",()=>{O()}),f.addEventListener("message",ge=>{I();try{const{action:d,payload:m}=JSON.parse(ge.data);switch(d){case"progress":{sa(this,m,this.uppy.getFile(e.id));break}case"success":{var ue,we,h,u;const y=(ue=m.response)==null?void 0:ue.responseText;this.uppy.emit("upload-success",this.uppy.getFile(e.id),{uploadURL:m.url,status:(we=(h=m.response)==null?void 0:h.status)!=null?we:200,body:y?JSON.parse(y):void 0}),(u=p)==null||u.abort==null||u.abort(),s();break}case"error":{const{message:y}=m.error;throw Object.assign(new Error(y),{cause:m.error})}default:this.uppy.log(`Companion socket unknown action ${d}`,"warning")}}catch(d){R(d)}});const ft=()=>{this.uppy.log(`Closing socket ${e.id}`,"info"),clearTimeout(v),f&&f.close(),f=void 0};p.signal.addEventListener("abort",()=>{ft()})}),{retries:bi,signal:p.signal,onFailedAttempt:()=>{p.signal.aborted||this.uppy.log(`Retrying websocket ${e.id}`,"info")}})})().abortOn(p.signal)}catch(q){if(p.signal.aborted)return;R(q)}},P=R=>{o.resumableUploads&&(w=R,f&&O())},x=R=>{var I;o.individualCancellation&&R.id===e.id&&(U("cancel"),(I=p)==null||I.abort==null||I.abort(),this.uppy.log(`upload ${e.id} was removed`,"info"),s())},j=()=>{var R;U("cancel"),(R=p)==null||R.abort==null||R.abort(),this.uppy.log(`upload ${e.id} was canceled`,"info"),s()},k=(R,I)=>{(R==null?void 0:R.id)===e.id&&P(I)},N=()=>P(!0),C=()=>P(!1);this.uppy.on("file-removed",x),this.uppy.on("cancel-all",j),this.uppy.on("upload-pause",k),this.uppy.on("pause-all",N),this.uppy.on("resume-all",C),i=()=>{this.uppy.off("file-removed",x),this.uppy.off("cancel-all",j),this.uppy.off("upload-pause",k),this.uppy.off("pause-all",N),this.uppy.off("resume-all",C)},n.addEventListener("abort",()=>{var R;(R=p)==null||R.abort()}),b()})}finally{i==null||i()}}wi.VERSION=ca.version;function xe(t,e){if(!{}.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var va=0;function _i(t){return"__private_"+va+++"_"+t}var ee=_i("uppy"),Ut=_i("events");class Si{constructor(e){Object.defineProperty(this,ee,{writable:!0,value:void 0}),Object.defineProperty(this,Ut,{writable:!0,value:[]}),xe(this,ee)[ee]=e}on(e,r){return xe(this,Ut)[Ut].push([e,r]),xe(this,ee)[ee].on(e,r)}remove(){for(const[e,r]of xe(this,Ut)[Ut].splice(0))xe(this,ee)[ee].off(e,r)}onFilePause(e,r){this.on("upload-pause",(n,i)=>{e===(n==null?void 0:n.id)&&r(i)})}onFileRemove(e,r){this.on("file-removed",n=>{e===n.id&&r(n.id)})}onPause(e,r){this.on("upload-pause",(n,i)=>{e===(n==null?void 0:n.id)&&r(i)})}onRetry(e,r){this.on("upload-retry",n=>{e===(n==null?void 0:n.id)&&r()})}onRetryAll(e,r){this.on("retry-all",()=>{xe(this,ee)[ee].getFile(e)&&r()})}onPauseAll(e,r){this.on("pause-all",()=>{xe(this,ee)[ee].getFile(e)&&r()})}onCancelAll(e,r){var n=this;this.on("cancel-all",function(){xe(n,ee)[ee].getFile(e)&&r(...arguments)})}onResumeAll(e,r){this.on("resume-all",()=>{xe(this,ee)[ee].getFile(e)&&r()})}}function F(t,e){if(!{}.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var ba=0;function ae(t){return"__private_"+ba+++"_"+t}function wa(t){return new Error("Cancelled",{cause:t})}function Un(t){if(t!=null){var e;const r=()=>this.abort(t.reason);t.addEventListener("abort",r,{once:!0});const n=()=>{t.removeEventListener("abort",r)};(e=this.then)==null||e.call(this,n,n)}return this}var de=ae("activeRequests"),oe=ae("queuedHandlers"),ce=ae("paused"),Ae=ae("pauseTimer"),te=ae("downLimit"),Le=ae("upperLimit"),Re=ae("rateLimitingTimer"),Bt=ae("call"),je=ae("queueNext"),Nr=ae("next"),Er=ae("queue"),zr=ae("dequeue"),Or=ae("resume"),Ie=ae("increaseLimit");class Pi{constructor(e){Object.defineProperty(this,zr,{value:Ea}),Object.defineProperty(this,Er,{value:Ua}),Object.defineProperty(this,Nr,{value:Pa}),Object.defineProperty(this,je,{value:Sa}),Object.defineProperty(this,Bt,{value:_a}),Object.defineProperty(this,de,{writable:!0,value:0}),Object.defineProperty(this,oe,{writable:!0,value:[]}),Object.defineProperty(this,ce,{writable:!0,value:!1}),Object.defineProperty(this,Ae,{writable:!0,value:void 0}),Object.defineProperty(this,te,{writable:!0,value:1}),Object.defineProperty(this,Le,{writable:!0,value:void 0}),Object.defineProperty(this,Re,{writable:!0,value:void 0}),Object.defineProperty(this,Or,{writable:!0,value:()=>this.resume()}),Object.defineProperty(this,Ie,{writable:!0,value:()=>{if(F(this,ce)[ce]){F(this,Re)[Re]=setTimeout(F(this,Ie)[Ie],0);return}F(this,te)[te]=this.limit,this.limit=Math.ceil((F(this,Le)[Le]+F(this,te)[te])/2);for(let r=F(this,te)[te];r<=this.limit;r++)F(this,je)[je]();F(this,Le)[Le]-F(this,te)[te]>3?F(this,Re)[Re]=setTimeout(F(this,Ie)[Ie],2e3):F(this,te)[te]=Math.floor(F(this,te)[te]/2)}}),typeof e!="number"||e===0?this.limit=1/0:this.limit=e}run(e,r){return!F(this,ce)[ce]&&F(this,de)[de]<this.limit?F(this,Bt)[Bt](e):F(this,Er)[Er](e,r)}wrapSyncFunction(e,r){var n=this;return function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];const a=n.run(()=>(e(...o),queueMicrotask(()=>a.done()),()=>{}),r);return{abortOn:Un,abort(){a.abort()}}}}wrapPromiseFunction(e,r){var n=this;return function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];let a;const l=new Promise((c,f)=>{a=n.run(()=>{let p,v;try{v=Promise.resolve(e(...o))}catch(w){v=Promise.reject(w)}return v.then(w=>{p?f(p):(a.done(),c(w))},w=>{p?f(p):(a.done(),f(w))}),w=>{p=wa(w)}},r)});return l.abort=c=>{a.abort(c)},l.abortOn=Un,l}}resume(){F(this,ce)[ce]=!1,clearTimeout(F(this,Ae)[Ae]);for(let e=0;e<this.limit;e++)F(this,je)[je]()}pause(e){e===void 0&&(e=null),F(this,ce)[ce]=!0,clearTimeout(F(this,Ae)[Ae]),e!=null&&(F(this,Ae)[Ae]=setTimeout(F(this,Or)[Or],e))}rateLimit(e){clearTimeout(F(this,Re)[Re]),this.pause(e),this.limit>1&&Number.isFinite(this.limit)&&(F(this,Le)[Le]=this.limit-1,this.limit=F(this,te)[te],F(this,Re)[Re]=setTimeout(F(this,Ie)[Ie],e))}get isPaused(){return F(this,ce)[ce]}}function _a(t){F(this,de)[de]+=1;let e=!1,r;try{r=t()}catch(n){throw F(this,de)[de]-=1,n}return{abort:n=>{e||(e=!0,F(this,de)[de]-=1,r==null||r(n),F(this,je)[je]())},done:()=>{e||(e=!0,F(this,de)[de]-=1,F(this,je)[je]())}}}function Sa(){queueMicrotask(()=>F(this,Nr)[Nr]())}function Pa(){if(F(this,ce)[ce]||F(this,de)[de]>=this.limit||F(this,oe)[oe].length===0)return;const t=F(this,oe)[oe].shift();if(t==null)throw new Error("Invariant violation: next is null");const e=F(this,Bt)[Bt](t.fn);t.abort=e.abort,t.done=e.done}function Ua(t,e){const r={fn:t,priority:(e==null?void 0:e.priority)||0,abort:()=>{F(this,zr)[zr](r)},done:()=>{throw new Error("Cannot mark a queued request as done: this indicates a bug")}},n=F(this,oe)[oe].findIndex(i=>r.priority>i.priority);return n===-1?F(this,oe)[oe].push(r):F(this,oe)[oe].splice(n,0,r),r}function Ea(t){const e=F(this,oe)[oe].indexOf(t);e!==-1&&F(this,oe)[oe].splice(e,1)}function Ui(t){const e=r=>"error"in r&&!!r.error;return t.filter(r=>!e(r))}function Ei(t){return t.filter(e=>{var r;return!((r=e.progress)!=null&&r.uploadStarted)||!e.isRestored})}const{AbortController:Fr}=globalThis,Oi=function(t,e){t===void 0&&(t="Aborted");const r=new DOMException(t,"AbortError");return e!=null&&zt(e,"cause")&&Object.defineProperty(r,"cause",{__proto__:null,configurable:!0,writable:!0,value:e.cause}),r};function Br(t,e){return t===!0?Object.keys(e):Array.isArray(t)?t:[]}function S(t,e){if(!{}.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var Oa=0;function H(t){return"__private_"+Oa+++"_"+t}const Fa=1024*1024,En={getChunkSize(t){return Math.ceil(t.size/1e4)},onProgress(){},onPartComplete(){},onSuccess(){},onError(t){throw t}};function xa(t){if(typeof t=="string")return parseInt(t,10);if(typeof t=="number")return t;throw new TypeError("Expected a number")}const ur=Symbol("pausing upload, not an actual error");var V=H("abortController"),B=H("chunks"),ne=H("chunkState"),pe=H("data"),he=H("file"),Ht=H("uploadHasStarted"),Et=H("onError"),et=H("onSuccess"),$e=H("shouldUseMultipart"),Ke=H("isRestoring"),Wt=H("onReject"),ze=H("maxMultipartParts"),It=H("minPartSize"),xr=H("initChunks"),Rr=H("createUpload"),Ot=H("resumeUpload"),Mt=H("onPartProgress"),qt=H("onPartComplete"),Tr=H("abortUpload");class Ra{constructor(e,r){var n,i;Object.defineProperty(this,Tr,{value:ja}),Object.defineProperty(this,Ot,{value:Ca}),Object.defineProperty(this,Rr,{value:$a}),Object.defineProperty(this,xr,{value:Ta}),Object.defineProperty(this,V,{writable:!0,value:new Fr}),Object.defineProperty(this,B,{writable:!0,value:[]}),Object.defineProperty(this,ne,{writable:!0,value:[]}),Object.defineProperty(this,pe,{writable:!0,value:void 0}),Object.defineProperty(this,he,{writable:!0,value:void 0}),Object.defineProperty(this,Ht,{writable:!0,value:!1}),Object.defineProperty(this,Et,{writable:!0,value:void 0}),Object.defineProperty(this,et,{writable:!0,value:void 0}),Object.defineProperty(this,$e,{writable:!0,value:void 0}),Object.defineProperty(this,Ke,{writable:!0,value:void 0}),Object.defineProperty(this,Wt,{writable:!0,value:o=>(o==null?void 0:o.cause)===ur?null:S(this,Et)[Et](o)}),Object.defineProperty(this,ze,{writable:!0,value:1e4}),Object.defineProperty(this,It,{writable:!0,value:5*Fa}),Object.defineProperty(this,Mt,{writable:!0,value:o=>s=>{if(!s.lengthComputable)return;S(this,ne)[ne][o].uploaded=xa(s.loaded);const a=S(this,ne)[ne].reduce((l,c)=>l+c.uploaded,0);this.options.onProgress(a,S(this,pe)[pe].size)}}),Object.defineProperty(this,qt,{writable:!0,value:o=>s=>{S(this,B)[B][o]=null,S(this,ne)[ne][o].etag=s,S(this,ne)[ne][o].done=!0;const a={PartNumber:o+1,ETag:s};this.options.onPartComplete(a)}}),this.options={...En,...r},(i=(n=this.options).getChunkSize)!=null||(n.getChunkSize=En.getChunkSize),S(this,pe)[pe]=e,S(this,he)[he]=r.file,S(this,et)[et]=this.options.onSuccess,S(this,Et)[Et]=this.options.onError,S(this,$e)[$e]=this.options.shouldUseMultipart,S(this,Ke)[Ke]=r.uploadId&&r.key,S(this,xr)[xr]()}start(){S(this,Ht)[Ht]?(S(this,V)[V].signal.aborted||S(this,V)[V].abort(ur),S(this,V)[V]=new Fr,S(this,Ot)[Ot]()):S(this,Ke)[Ke]?(this.options.companionComm.restoreUploadFile(S(this,he)[he],{uploadId:this.options.uploadId,key:this.options.key}),S(this,Ot)[Ot]()):S(this,Rr)[Rr]()}pause(){S(this,V)[V].abort(ur),S(this,V)[V]=new Fr}abort(e){e!=null&&e.really?S(this,Tr)[Tr]():this.pause()}[Symbol.for("uppy test: getChunkState")](){return S(this,ne)[ne]}}function Ta(){const t=S(this,pe)[pe].size,e=typeof S(this,$e)[$e]=="function"?S(this,$e)[$e](S(this,he)[he]):!!S(this,$e)[$e];if(e&&t>S(this,It)[It]){let r=Math.max(this.options.getChunkSize(S(this,pe)[pe]),S(this,It)[It]),n=Math.floor(t/r);n>S(this,ze)[ze]&&(n=S(this,ze)[ze],r=t/S(this,ze)[ze]),S(this,B)[B]=Array(n);for(let i=0,o=0;i<t;i+=r,o++){const s=Math.min(t,i+r),a=()=>{const l=i;return S(this,pe)[pe].slice(l,s)};if(S(this,B)[B][o]={getData:a,onProgress:S(this,Mt)[Mt](o),onComplete:S(this,qt)[qt](o),shouldUseMultipart:e},S(this,Ke)[Ke]){const l=i+r>t?t-i:r;S(this,B)[B][o].setAsUploaded=()=>{S(this,B)[B][o]=null,S(this,ne)[ne][o].uploaded=l}}}}else S(this,B)[B]=[{getData:()=>S(this,pe)[pe],onProgress:S(this,Mt)[Mt](0),onComplete:S(this,qt)[qt](0),shouldUseMultipart:e}];S(this,ne)[ne]=S(this,B)[B].map(()=>({uploaded:0}))}function $a(){this.options.companionComm.uploadFile(S(this,he)[he],S(this,B)[B],S(this,V)[V].signal).then(S(this,et)[et],S(this,Wt)[Wt]),S(this,Ht)[Ht]=!0}function Ca(){this.options.companionComm.resumeUploadFile(S(this,he)[he],S(this,B)[B],S(this,V)[V].signal).then(S(this,et)[et],S(this,Wt)[Wt])}function ja(){S(this,V)[V].abort(),this.options.companionComm.abortFileUpload(S(this,he)[he]).catch(t=>this.options.log(t))}function J(t){if(t!=null&&t.aborted)throw Oi("The operation was aborted",{cause:t.reason})}function ka(t){let{method:e="PUT",CanonicalUri:r="/",CanonicalQueryString:n="",SignedHeaders:i,HashedPayload:o}=t;const s=Object.keys(i).map(a=>a.toLowerCase()).sort();return[e,r,n,...s.map(a=>`${a}:${i[a]}`),"",s.join(";"),o].join(`
`)}const nn=new TextEncoder,on={name:"HMAC",hash:"SHA-256"};async function Aa(t){const{subtle:e}=globalThis.crypto;return e.digest(on.hash,nn.encode(t))}async function La(t){const{subtle:e}=globalThis.crypto;return e.importKey("raw",typeof t=="string"?nn.encode(t):t,on,!1,["sign"])}function On(t){const e=new Uint8Array(t);let r="";for(let n=0;n<e.length;n++)r+=e[n].toString(16).padStart(2,"0");return r}async function Ft(t,e){const{subtle:r}=globalThis.crypto;return r.sign(on,await La(t),nn.encode(e))}async function Ia(t){let{accountKey:e,accountSecret:r,sessionToken:n,bucketName:i,Key:o,Region:s,expires:a,uploadId:l,partNumber:c}=t;const f="s3",p=`${f}.${s}.amazonaws.com`,v=`/${i}/${encodeURI(o).replace(/[;?:@&=+$,#!'()*]/g,be=>`%${be.charCodeAt(0).toString(16).toUpperCase()}`)}`,w="UNSIGNED-PAYLOAD",U=new Date().toISOString().replace(/[-:]|\.\d+/g,""),O=U.slice(0,8),b=`${O}/${s}/${f}/aws4_request`,P=new URL(`https://${p}${v}`);P.searchParams.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),P.searchParams.set("X-Amz-Content-Sha256",w),P.searchParams.set("X-Amz-Credential",`${e}/${b}`),P.searchParams.set("X-Amz-Date",U),P.searchParams.set("X-Amz-Expires",a),P.searchParams.set("X-Amz-Security-Token",n),P.searchParams.set("X-Amz-SignedHeaders","host"),c&&P.searchParams.set("partNumber",c),l&&P.searchParams.set("uploadId",l),P.searchParams.set("x-id",c&&l?"UploadPart":"PutObject");const x=ka({CanonicalUri:v,CanonicalQueryString:P.search.slice(1),SignedHeaders:{host:p},HashedPayload:w}),j=On(await Aa(x)),k=["AWS4-HMAC-SHA256",U,b,j].join(`
`),N=await Ft(`AWS4${r}`,O),C=await Ft(N,s),R=await Ft(C,f),I=await Ft(R,"aws4_request"),q=On(await Ft(I,k));return P.searchParams.set("X-Amz-Signature",q),P}function T(t,e){if(!{}.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var Ma=0;function se(t){return"__private_"+Ma+++"_"+t}function qa(t){const e=new URL(t);return e.search="",e.hash="",e.href}var xt=se("abortMultipartUpload"),K=se("cache"),Rt=se("createMultipartUpload"),Tt=se("fetchSignature"),Dt=se("getUploadParameters"),$t=se("listParts"),Be=se("previousRetryDelay"),We=se("requests"),Me=se("retryDelays"),qe=se("sendCompletionRequest"),Ne=se("setS3MultipartState"),Xe=se("uploadPartBytes"),X=se("getFile"),$r=se("shouldRetry"),Ct=se("nonMultipartUpload");class Na{constructor(e,r,n,i){Object.defineProperty(this,Ct,{value:Ba}),Object.defineProperty(this,$r,{value:za}),Object.defineProperty(this,xt,{writable:!0,value:void 0}),Object.defineProperty(this,K,{writable:!0,value:new WeakMap}),Object.defineProperty(this,Rt,{writable:!0,value:void 0}),Object.defineProperty(this,Tt,{writable:!0,value:void 0}),Object.defineProperty(this,Dt,{writable:!0,value:void 0}),Object.defineProperty(this,$t,{writable:!0,value:void 0}),Object.defineProperty(this,Be,{writable:!0,value:void 0}),Object.defineProperty(this,We,{writable:!0,value:void 0}),Object.defineProperty(this,Me,{writable:!0,value:void 0}),Object.defineProperty(this,qe,{writable:!0,value:void 0}),Object.defineProperty(this,Ne,{writable:!0,value:void 0}),Object.defineProperty(this,Xe,{writable:!0,value:void 0}),Object.defineProperty(this,X,{writable:!0,value:void 0}),T(this,We)[We]=e,T(this,Ne)[Ne]=n,T(this,X)[X]=i,this.setOptions(r)}setOptions(e){const r=T(this,We)[We];if("abortMultipartUpload"in e&&(T(this,xt)[xt]=r.wrapPromiseFunction(e.abortMultipartUpload,{priority:1})),"createMultipartUpload"in e&&(T(this,Rt)[Rt]=r.wrapPromiseFunction(e.createMultipartUpload,{priority:-1})),"signPart"in e&&(T(this,Tt)[Tt]=r.wrapPromiseFunction(e.signPart)),"listParts"in e&&(T(this,$t)[$t]=r.wrapPromiseFunction(e.listParts)),"completeMultipartUpload"in e&&(T(this,qe)[qe]=r.wrapPromiseFunction(e.completeMultipartUpload,{priority:1})),"retryDelays"in e){var n;T(this,Me)[Me]=(n=e.retryDelays)!=null?n:[]}"uploadPartBytes"in e&&(T(this,Xe)[Xe]=r.wrapPromiseFunction(e.uploadPartBytes,{priority:1/0})),"getUploadParameters"in e&&(T(this,Dt)[Dt]=r.wrapPromiseFunction(e.getUploadParameters))}async getUploadId(e,r){let n;for(;(n=T(this,K)[K].get(e.data))!=null;)try{return await n}catch{}const i=T(this,Rt)[Rt](T(this,X)[X](e),r),o=()=>{i.abort(r.reason),T(this,K)[K].delete(e.data)};return r.addEventListener("abort",o,{once:!0}),T(this,K)[K].set(e.data,i),i.then(async s=>{r.removeEventListener("abort",o),T(this,Ne)[Ne](e,s),T(this,K)[K].set(e.data,s)},()=>{r.removeEventListener("abort",o),T(this,K)[K].delete(e.data)}),i}async abortFileUpload(e){const r=T(this,K)[K].get(e.data);if(r==null)return;T(this,K)[K].delete(e.data),T(this,Ne)[Ne](e,Object.create(null));let n;try{n=await r}catch{return}await T(this,xt)[xt](T(this,X)[X](e),n)}async uploadFile(e,r,n){if(J(n),r.length===1&&!r[0].shouldUseMultipart)return T(this,Ct)[Ct](e,r[0],n);const{uploadId:i,key:o}=await this.getUploadId(e,n);J(n);try{const s=await Promise.all(r.map((a,l)=>this.uploadChunk(e,l+1,a,n)));return J(n),await T(this,qe)[qe](T(this,X)[X](e),{key:o,uploadId:i,parts:s,signal:n},n).abortOn(n)}catch(s){throw(s==null?void 0:s.cause)!==ur&&(s==null?void 0:s.name)!=="AbortError"&&this.abortFileUpload(e),s}}restoreUploadFile(e,r){T(this,K)[K].set(e.data,r)}async resumeUploadFile(e,r,n){if(J(n),r.length===1&&r[0]!=null&&!r[0].shouldUseMultipart)return T(this,Ct)[Ct](e,r[0],n);const{uploadId:i,key:o}=await this.getUploadId(e,n);J(n);const s=await T(this,$t)[$t](T(this,X)[X](e),{uploadId:i,key:o,signal:n},n).abortOn(n);J(n);const a=await Promise.all(r.map((l,c)=>{const f=c+1,p=s.find(v=>{let{PartNumber:w}=v;return w===f});return p==null?this.uploadChunk(e,f,l,n):(l==null||l.setAsUploaded==null||l.setAsUploaded(),{PartNumber:f,ETag:p.ETag})}));return J(n),T(this,qe)[qe](T(this,X)[X](e),{key:o,uploadId:i,parts:a,signal:n},n).abortOn(n)}async uploadChunk(e,r,n,i){J(i);const{uploadId:o,key:s}=await this.getUploadId(e,i),a=T(this,Me)[Me].values(),l=T(this,Me)[Me].values(),c=()=>{const f=a.next();return f==null||f.done?null:f.value};for(;;){J(i);const f=n.getData(),{onProgress:p,onComplete:v}=n;let w;try{w=await T(this,Tt)[Tt](T(this,X)[X](e),{uploadId:o,key:s,partNumber:r,body:f,signal:i}).abortOn(i)}catch(U){const O=c();if(O==null||i.aborted)throw U;await new Promise(b=>setTimeout(b,O));continue}J(i);try{return{PartNumber:r,...await T(this,Xe)[Xe]({signature:w,body:f,size:f.size,onProgress:p,onComplete:v,signal:i}).abortOn(i)}}catch(U){if(!await T(this,$r)[$r](U,l))throw U}}}}async function za(t,e){var r;const n=T(this,We)[We],i=t==null||(r=t.source)==null?void 0:r.status;if(i==null)return!1;if(i===403&&t.message==="Request has expired"){if(!n.isPaused){if(n.limit===1||T(this,Be)[Be]==null){const o=e.next();if(o==null||o.done)return!1;T(this,Be)[Be]=o.value}n.rateLimit(0),await new Promise(o=>setTimeout(o,T(this,Be)[Be]))}}else if(i===429){if(!n.isPaused){const o=e.next();if(o==null||o.done)return!1;n.rateLimit(o.value)}}else{if(i>400&&i<500&&i!==409)return!1;if(typeof navigator<"u"&&navigator.onLine===!1)n.isPaused||(n.pause(),window.addEventListener("online",()=>{n.resume()},{once:!0}));else{const o=e.next();if(o==null||o.done)return!1;await new Promise(s=>setTimeout(s,o.value))}}return!0}async function Ba(t,e,r){const{method:n="POST",url:i,fields:o,headers:s}=await T(this,Dt)[Dt](T(this,X)[X](t),{signal:r}).abortOn(r);let a;const l=e.getData();if(n.toUpperCase()==="POST"){const v=new FormData;Object.entries(o).forEach(w=>{let[U,O]=w;return v.set(U,O)}),v.set("file",l),a=v}else a=l;const{onProgress:c,onComplete:f}=e,p=await T(this,Xe)[Xe]({signature:{url:i,headers:s,method:n},body:a,size:l.size,onProgress:c,onComplete:f,signal:r}).abortOn(r);return"location"in p?p:{location:qa(i),...p}}function E(t,e){if(!{}.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var Ha=0;function le(t){return"__private_"+Ha+++"_"+t}const Da={version:"4.1.0"};function it(t){if(t!=null&&t.error){const e=new Error(t.message);throw Object.assign(e,t.error),e}return t}function Fi(t){const e=t.Expiration;if(e){const r=Math.floor((new Date(e)-Date.now())/1e3);if(r>9)return r}}function Fn(t){let{meta:e,allowedMetaFields:r,querify:n=!1}=t;const i=r??Object.keys(e);return e?Object.fromEntries(i.filter(o=>e[o]!=null).map(o=>{const s=n?`metadata[${o}]`:o,a=String(e[o]);return[s,a]})):{}}const Ga={allowedMetaFields:!0,limit:6,getTemporarySecurityCredentials:!1,shouldUseMultipart:t=>t.size>>10>>10>100,retryDelays:[0,1e3,3e3,5e3]};var Ve=le("companionCommunicationQueue"),M=le("client"),jt=le("setClient"),re=le("assertHost"),W=le("cachedTemporaryCredentials"),Cr=le("getTemporarySecurityCredentials"),jr=le("setS3MultipartState"),Qe=le("getFile"),kr=le("uploadLocalFile"),Ar=le("getCompanionClientArgs"),kt=le("upload"),Ye=le("setCompanionHeaders"),Te=le("setResumableUploadsCapability"),At=le("resetResumableCapability");class gr extends mi{constructor(e,r){var n;super(e,{...Ga,uploadPartBytes:gr.uploadPartBytes,createMultipartUpload:null,listParts:null,abortMultipartUpload:null,completeMultipartUpload:null,signPart:null,getUploadParameters:null,...r}),Object.defineProperty(this,Ar,{value:Ya}),Object.defineProperty(this,kr,{value:Va}),Object.defineProperty(this,Cr,{value:Xa}),Object.defineProperty(this,re,{value:Wa}),Object.defineProperty(this,jt,{value:Ka}),Object.defineProperty(this,Ve,{writable:!0,value:void 0}),Object.defineProperty(this,M,{writable:!0,value:void 0}),Object.defineProperty(this,W,{writable:!0,value:void 0}),Object.defineProperty(this,jr,{writable:!0,value:(o,s)=>{let{key:a,uploadId:l}=s;const c=this.uppy.getFile(o.id);c!=null&&this.uppy.setFileState(o.id,{s3Multipart:{...c.s3Multipart,key:a,uploadId:l}})}}),Object.defineProperty(this,Qe,{writable:!0,value:o=>this.uppy.getFile(o.id)||o}),Object.defineProperty(this,kt,{writable:!0,value:async o=>{if(o.length===0)return;const s=this.uppy.getFilesByIds(o),a=Ui(s),l=Ei(a);this.uppy.emit("upload-start",l);const c=a.map(p=>{if(p.isRemote){const v=()=>this.requests;E(this,Te)[Te](!1);const w=new AbortController,U=b=>{b.id===p.id&&w.abort()};this.uppy.on("file-removed",U);const O=this.uppy.getRequestClientForFile(p).uploadRemoteFile(p,E(this,Ar)[Ar](p),{signal:w.signal,getQueue:v});return this.requests.wrapSyncFunction(()=>{this.uppy.off("file-removed",U)},{priority:-1})(),O}return E(this,kr)[kr](p)}),f=await Promise.all(c);return E(this,Te)[Te](!0),f}}),Object.defineProperty(this,Ye,{writable:!0,value:()=>{var o;(o=E(this,M)[M])==null||o.setCompanionHeaders(this.opts.headers)}}),Object.defineProperty(this,Te,{writable:!0,value:o=>{const{capabilities:s}=this.uppy.getState();this.uppy.setState({capabilities:{...s,resumableUploads:o}})}}),Object.defineProperty(this,At,{writable:!0,value:()=>{E(this,Te)[Te](!0)}}),this.type="uploader",this.id=this.opts.id||"AwsS3Multipart",E(this,jt)[jt](r);const i={createMultipartUpload:this.createMultipartUpload,listParts:this.listParts,abortMultipartUpload:this.abortMultipartUpload,completeMultipartUpload:this.completeMultipartUpload,signPart:r!=null&&r.getTemporarySecurityCredentials?this.createSignedURL:this.signPart,getUploadParameters:r!=null&&r.getTemporarySecurityCredentials?this.createSignedURL:this.getUploadParameters};for(const o of Object.keys(i))this.opts[o]==null&&(this.opts[o]=i[o].bind(this));this.requests=(n=this.opts.rateLimitedQueue)!=null?n:new Pi(this.opts.limit),E(this,Ve)[Ve]=new Na(this.requests,this.opts,E(this,jr)[jr],E(this,Qe)[Qe]),this.uploaders=Object.create(null),this.uploaderEvents=Object.create(null)}[Symbol.for("uppy test: getClient")](){return E(this,M)[M]}setOptions(e){E(this,Ve)[Ve].setOptions(e),super.setOptions(e),E(this,jt)[jt](e)}resetUploaderReferences(e,r){this.uploaders[e]&&(this.uploaders[e].abort({really:(r==null?void 0:r.abort)||!1}),this.uploaders[e]=null),this.uploaderEvents[e]&&(this.uploaderEvents[e].remove(),this.uploaderEvents[e]=null)}createMultipartUpload(e,r){E(this,re)[re]("createMultipartUpload"),J(r);const n=Br(this.opts.allowedMetaFields,e.meta),i=Fn({meta:e.meta,allowedMetaFields:n});return E(this,M)[M].post("s3/multipart",{filename:e.name,type:e.type,metadata:i},{signal:r}).then(it)}listParts(e,r,n){var i;let{key:o,uploadId:s,signal:a}=r;(i=a)!=null||(a=n),E(this,re)[re]("listParts"),J(a);const l=encodeURIComponent(o);return E(this,M)[M].get(`s3/multipart/${encodeURIComponent(s)}?key=${l}`,{signal:a}).then(it)}completeMultipartUpload(e,r,n){var i;let{key:o,uploadId:s,parts:a,signal:l}=r;(i=l)!=null||(l=n),E(this,re)[re]("completeMultipartUpload"),J(l);const c=encodeURIComponent(o),f=encodeURIComponent(s);return E(this,M)[M].post(`s3/multipart/${f}/complete?key=${c}`,{parts:a.map(p=>{let{ETag:v,PartNumber:w}=p;return{ETag:v,PartNumber:w}})},{signal:l}).then(it)}async createSignedURL(e,r){const n=await E(this,Cr)[Cr](r),i=Fi(n.credentials)||604800,{uploadId:o,key:s,partNumber:a}=r;return{method:"PUT",expires:i,fields:{},url:`${await Ia({accountKey:n.credentials.AccessKeyId,accountSecret:n.credentials.SecretAccessKey,sessionToken:n.credentials.SessionToken,expires:i,bucketName:n.bucket,Region:n.region,Key:s??`${crypto.randomUUID()}-${e.name}`,uploadId:o,partNumber:a})}`,headers:{"Content-Type":e.type}}}signPart(e,r){let{uploadId:n,key:i,partNumber:o,signal:s}=r;if(E(this,re)[re]("signPart"),J(s),n==null||i==null||o==null)throw new Error("Cannot sign without a key, an uploadId, and a partNumber");const a=encodeURIComponent(i);return E(this,M)[M].get(`s3/multipart/${encodeURIComponent(n)}/${o}?key=${a}`,{signal:s}).then(it)}abortMultipartUpload(e,r){let{key:n,uploadId:i,signal:o}=r;E(this,re)[re]("abortMultipartUpload");const s=encodeURIComponent(n),a=encodeURIComponent(i);return E(this,M)[M].delete(`s3/multipart/${a}?key=${s}`,void 0,{signal:o}).then(it)}getUploadParameters(e,r){E(this,re)[re]("getUploadParameters");const{meta:n}=e,{type:i,name:o}=n,s=Br(this.opts.allowedMetaFields,e.meta),a=Fn({meta:n,allowedMetaFields:s,querify:!0}),l=new URLSearchParams({filename:o,type:i,...a});return E(this,M)[M].get(`s3/params?${l}`,r)}static async uploadPartBytes(e){let{signature:{url:r,expires:n,headers:i,method:o="PUT"},body:s,size:a=s.size,onProgress:l,onComplete:c,signal:f}=e;if(J(f),r==null)throw new Error("Cannot upload to an undefined URL");return new Promise((p,v)=>{const w=new XMLHttpRequest;w.open(o,r,!0),i&&Object.keys(i).forEach(b=>{w.setRequestHeader(b,i[b])}),w.responseType="text",typeof n=="number"&&(w.timeout=n*1e3);function U(){w.abort()}function O(){f==null||f.removeEventListener("abort",U)}f==null||f.addEventListener("abort",U),w.upload.addEventListener("progress",b=>{l(b)}),w.addEventListener("abort",()=>{O(),v(Oi())}),w.addEventListener("timeout",()=>{O();const b=new Error("Request has expired");b.source={status:403},v(b)}),w.addEventListener("load",()=>{if(O(),w.status===403&&w.responseText.includes("<Message>Request has expired</Message>")){const k=new Error("Request has expired");k.source=w,v(k);return}if(w.status<200||w.status>=300){const k=new Error("Non 2xx");k.source=w,v(k);return}l==null||l({loaded:a,lengthComputable:!0});const b=w.getAllResponseHeaders().trim().split(/[\r\n]+/),P={__proto__:null};for(const k of b){const N=k.split(": "),C=N.shift(),R=N.join(": ");P[C]=R}const{etag:x,location:j}=P;if(o.toUpperCase()==="POST"&&j===null&&console.warn("AwsS3/Multipart: Could not read the Location header. This likely means CORS is not configured correctly on the S3 Bucket. See https://uppy.io/docs/aws-s3-multipart#S3-Bucket-Configuration for instructions."),x===null){v(new Error("AwsS3/Multipart: Could not read the ETag header. This likely means CORS is not configured correctly on the S3 Bucket. See https://uppy.io/docs/aws-s3-multipart#S3-Bucket-Configuration for instructions."));return}c==null||c(x),p({...P,ETag:x})}),w.addEventListener("error",b=>{O();const P=new Error("Unknown error");P.source=b.target,v(P)}),w.send(s)})}install(){E(this,Te)[Te](!0),this.uppy.addPreProcessor(E(this,Ye)[Ye]),this.uppy.addUploader(E(this,kt)[kt]),this.uppy.on("cancel-all",E(this,At)[At])}uninstall(){this.uppy.removePreProcessor(E(this,Ye)[Ye]),this.uppy.removeUploader(E(this,kt)[kt]),this.uppy.off("cancel-all",E(this,At)[At])}}function Ka(t){t==null||!("endpoint"in t||"companionUrl"in t||"headers"in t||"companionHeaders"in t||"cookiesRule"in t||"companionCookiesRule"in t)||("companionUrl"in t&&!("endpoint"in t)&&this.uppy.log("`companionUrl` option has been removed in @uppy/aws-s3, use `endpoint` instead.","warning"),"companionHeaders"in t&&!("headers"in t)&&this.uppy.log("`companionHeaders` option has been removed in @uppy/aws-s3, use `headers` instead.","warning"),"companionCookiesRule"in t&&!("cookiesRule"in t)&&this.uppy.log("`companionCookiesRule` option has been removed in @uppy/aws-s3, use `cookiesRule` instead.","warning"),"endpoint"in t?E(this,M)[M]=new wi(this.uppy,{pluginId:this.id,provider:"AWS",companionUrl:this.opts.endpoint,companionHeaders:this.opts.headers,companionCookiesRule:this.opts.cookiesRule}):("headers"in t&&E(this,Ye)[Ye](),"cookiesRule"in t&&(E(this,M)[M].opts.companionCookiesRule=t.cookiesRule)))}function Wa(t){if(!E(this,M)[M])throw new Error(`Expected a \`endpoint\` option containing a URL, or if you are not using Companion, a custom \`${t}\` implementation.`)}async function Xa(t){if(J(t==null?void 0:t.signal),E(this,W)[W]==null){const{getTemporarySecurityCredentials:e}=this.opts;e===!0?(E(this,re)[re]("getTemporarySecurityCredentials"),E(this,W)[W]=E(this,M)[M].get("s3/sts",t).then(it)):E(this,W)[W]=e(t),E(this,W)[W]=await E(this,W)[W],setTimeout(()=>{E(this,W)[W]=null},(Fi(E(this,W)[W].credentials)||0)*500)}return E(this,W)[W]}function Va(t){var e=this;return new Promise((r,n)=>{const i=(c,f)=>{var p;const v=this.uppy.getFile(t.id);this.uppy.emit("upload-progress",v,{uploadStarted:(p=v.progress.uploadStarted)!=null?p:0,bytesUploaded:c,bytesTotal:f})},o=c=>{this.uppy.log(c),this.uppy.emit("upload-error",t,c),this.resetUploaderReferences(t.id),n(c)},s=c=>{const f={body:{...c},status:200,uploadURL:c.location};this.resetUploaderReferences(t.id),this.uppy.emit("upload-success",E(this,Qe)[Qe](t),f),c.location&&this.uppy.log(`Download ${t.name} from ${c.location}`),r()},a=new Ra(t.data,{companionComm:E(this,Ve)[Ve],log:function(){return e.uppy.log(...arguments)},getChunkSize:this.opts.getChunkSize?this.opts.getChunkSize.bind(this):void 0,onProgress:i,onError:o,onSuccess:s,onPartComplete:c=>{this.uppy.emit("s3-multipart:part-uploaded",E(this,Qe)[Qe](t),c)},file:t,shouldUseMultipart:this.opts.shouldUseMultipart,...t.s3Multipart});this.uploaders[t.id]=a;const l=new Si(this.uppy);this.uploaderEvents[t.id]=l,l.onFileRemove(t.id,c=>{a.abort(),this.resetUploaderReferences(t.id,{abort:!0}),r(`upload ${c} was removed`)}),l.onCancelAll(t.id,()=>{a.abort(),this.resetUploaderReferences(t.id,{abort:!0}),r(`upload ${t.id} was canceled`)}),l.onFilePause(t.id,c=>{c?a.pause():a.start()}),l.onPauseAll(t.id,()=>{a.pause()}),l.onResumeAll(t.id,()=>{a.start()}),a.start()})}function Ya(t){var e;return{...(e=t.remote)==null?void 0:e.body,protocol:"s3-multipart",size:t.data.size,metadata:t.meta}}gr.VERSION=Da.version;function ut(t){"@babel/helpers - typeof";return ut=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(t)}function xn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Qa(n.key),n)}}function Ja(t,e,r){return e&&xn(t.prototype,e),r&&xn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Qa(t){var e=Za(t,"string");return ut(e)=="symbol"?e:e+""}function Za(t,e){if(ut(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(ut(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function el(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tl(t,e,r){return e=Vt(e),rl(t,sn()?Reflect.construct(e,r||[],Vt(t).constructor):e.apply(t,r))}function rl(t,e){if(e&&(ut(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nl(t)}function nl(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function il(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xt(t,e)}function Hr(t){var e=typeof Map=="function"?new Map:void 0;return Hr=function(n){if(n===null||!sl(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(n))return e.get(n);e.set(n,i)}function i(){return ol(n,arguments,Vt(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Xt(i,n)},Hr(t)}function ol(t,e,r){if(sn())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var i=new(t.bind.apply(t,n));return r&&Xt(i,r.prototype),i}function sn(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sn=function(){return!!t})()}function sl(t){try{return Function.toString.call(t).indexOf("[native code]")!==-1}catch{return typeof t=="function"}}function Xt(t,e){return Xt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Xt(t,e)}function Vt(t){return Vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Vt(t)}var or=function(t){function e(r){var n,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(el(this,e),n=tl(this,e,[r]),n.originalRequest=o,n.originalResponse=s,n.causingError=i,i!=null&&(r+=", caused by ".concat(i.toString())),o!=null){var a=o.getHeader("X-Request-ID")||"n/a",l=o.getMethod(),c=o.getURL(),f=s?s.getStatus():"n/a",p=s?s.getBody()||"":"n/a";r+=", originated from request (method: ".concat(l,", url: ").concat(c,", response code: ").concat(f,", response text: ").concat(p,", request id: ").concat(a,")")}return n.message=r,n}return il(e,t),Ja(e)}(Hr(Error));function Yt(t){"@babel/helpers - typeof";return Yt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yt(t)}function al(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Rn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ul(n.key),n)}}function ll(t,e,r){return e&&Rn(t.prototype,e),r&&Rn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function ul(t){var e=cl(t,"string");return Yt(e)=="symbol"?e:e+""}function cl(t,e){if(Yt(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(Yt(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var dl=function(){function t(){al(this,t)}return ll(t,[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(r){return Promise.resolve([])}},{key:"removeUpload",value:function(r){return Promise.resolve()}},{key:"addUpload",value:function(r,n){return Promise.resolve(null)}}])}();const xi="3.7.7",pl=xi,pt=typeof Buffer=="function",Tn=typeof TextDecoder=="function"?new TextDecoder:void 0,$n=typeof TextEncoder=="function"?new TextEncoder:void 0,fl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Nt=Array.prototype.slice.call(fl),sr=(t=>{let e={};return t.forEach((r,n)=>e[r]=n),e})(Nt),hl=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Y=String.fromCharCode.bind(String),Cn=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),Ri=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),Ti=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),$i=t=>{let e,r,n,i,o="";const s=t.length%3;for(let a=0;a<t.length;){if((r=t.charCodeAt(a++))>255||(n=t.charCodeAt(a++))>255||(i=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=r<<16|n<<8|i,o+=Nt[e>>18&63]+Nt[e>>12&63]+Nt[e>>6&63]+Nt[e&63]}return s?o.slice(0,s-3)+"===".substring(s):o},an=typeof btoa=="function"?t=>btoa(t):pt?t=>Buffer.from(t,"binary").toString("base64"):$i,Dr=pt?t=>Buffer.from(t).toString("base64"):t=>{let r=[];for(let n=0,i=t.length;n<i;n+=4096)r.push(Y.apply(null,t.subarray(n,n+4096)));return an(r.join(""))},cr=(t,e=!1)=>e?Ri(Dr(t)):Dr(t),ml=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?Y(192|e>>>6)+Y(128|e&63):Y(224|e>>>12&15)+Y(128|e>>>6&63)+Y(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return Y(240|e>>>18&7)+Y(128|e>>>12&63)+Y(128|e>>>6&63)+Y(128|e&63)}},gl=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Ci=t=>t.replace(gl,ml),jn=pt?t=>Buffer.from(t,"utf8").toString("base64"):$n?t=>Dr($n.encode(t)):t=>an(Ci(t)),lt=(t,e=!1)=>e?Ri(jn(t)):jn(t),kn=t=>lt(t,!0),yl=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,vl=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),r=e-65536;return Y((r>>>10)+55296)+Y((r&1023)+56320);case 3:return Y((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return Y((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},ji=t=>t.replace(yl,vl),ki=t=>{if(t=t.replace(/\s+/g,""),!hl.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,r="",n,i;for(let o=0;o<t.length;)e=sr[t.charAt(o++)]<<18|sr[t.charAt(o++)]<<12|(n=sr[t.charAt(o++)])<<6|(i=sr[t.charAt(o++)]),r+=n===64?Y(e>>16&255):i===64?Y(e>>16&255,e>>8&255):Y(e>>16&255,e>>8&255,e&255);return r},ln=typeof atob=="function"?t=>atob(Ti(t)):pt?t=>Buffer.from(t,"base64").toString("binary"):ki,Ai=pt?t=>Cn(Buffer.from(t,"base64")):t=>Cn(ln(t).split("").map(e=>e.charCodeAt(0))),Li=t=>Ai(Ii(t)),bl=pt?t=>Buffer.from(t,"base64").toString("utf8"):Tn?t=>Tn.decode(Ai(t)):t=>ji(ln(t)),Ii=t=>Ti(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),Gr=t=>bl(Ii(t)),wl=t=>{if(typeof t!="string")return!1;const e=t.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},Mi=t=>({value:t,enumerable:!1,writable:!0,configurable:!0}),qi=function(){const t=(e,r)=>Object.defineProperty(String.prototype,e,Mi(r));t("fromBase64",function(){return Gr(this)}),t("toBase64",function(e){return lt(this,e)}),t("toBase64URI",function(){return lt(this,!0)}),t("toBase64URL",function(){return lt(this,!0)}),t("toUint8Array",function(){return Li(this)})},Ni=function(){const t=(e,r)=>Object.defineProperty(Uint8Array.prototype,e,Mi(r));t("toBase64",function(e){return cr(this,e)}),t("toBase64URI",function(){return cr(this,!0)}),t("toBase64URL",function(){return cr(this,!0)})},_l=()=>{qi(),Ni()},Sl={version:xi,VERSION:pl,atob:ln,atobPolyfill:ki,btoa:an,btoaPolyfill:$i,fromBase64:Gr,toBase64:lt,encode:lt,encodeURI:kn,encodeURL:kn,utob:Ci,btou:ji,decode:Gr,isValid:wl,fromUint8Array:cr,toUint8Array:Li,extendString:qi,extendUint8Array:Ni,extendBuiltins:_l};var Pl=function(e,r){if(r=r.split(":")[0],e=+e,!e)return!1;switch(r){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0},un={},Ul=Object.prototype.hasOwnProperty,El;function An(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch{return null}}function Ln(t){try{return encodeURIComponent(t)}catch{return null}}function Ol(t){for(var e=/([^=?#&]+)=?([^&]*)/g,r={},n;n=e.exec(t);){var i=An(n[1]),o=An(n[2]);i===null||o===null||i in r||(r[i]=o)}return r}function Fl(t,e){e=e||"";var r=[],n,i;typeof e!="string"&&(e="?");for(i in t)if(Ul.call(t,i)){if(n=t[i],!n&&(n===null||n===El||isNaN(n))&&(n=""),i=Ln(i),n=Ln(n),i===null||n===null)continue;r.push(i+"="+n)}return r.length?e+r.join("&"):""}un.stringify=Fl;un.parse=Ol;var zi=Pl,yr=un,xl=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,Bi=/[\n\r\t]/g,Rl=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,Hi=/:\d+$/,Tl=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,$l=/^[a-zA-Z]:/;function cn(t){return(t||"").toString().replace(xl,"")}var Kr=[["#","hash"],["?","query"],function(e,r){return _e(r.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],In={hash:1,query:1};function Di(t){var e;typeof window<"u"?e=window:typeof st<"u"?e=st:typeof self<"u"?e=self:e={};var r=e.location||{};t=t||r;var n={},i=typeof t,o;if(t.protocol==="blob:")n=new Se(unescape(t.pathname),{});else if(i==="string"){n=new Se(t,{});for(o in In)delete n[o]}else if(i==="object"){for(o in t)o in In||(n[o]=t[o]);n.slashes===void 0&&(n.slashes=Rl.test(t.href))}return n}function _e(t){return t==="file:"||t==="ftp:"||t==="http:"||t==="https:"||t==="ws:"||t==="wss:"}function Gi(t,e){t=cn(t),t=t.replace(Bi,""),e=e||{};var r=Tl.exec(t),n=r[1]?r[1].toLowerCase():"",i=!!r[2],o=!!r[3],s=0,a;return i?o?(a=r[2]+r[3]+r[4],s=r[2].length+r[3].length):(a=r[2]+r[4],s=r[2].length):o?(a=r[3]+r[4],s=r[3].length):a=r[4],n==="file:"?s>=2&&(a=a.slice(2)):_e(n)?a=r[4]:n?i&&(a=a.slice(2)):s>=2&&_e(e.protocol)&&(a=r[4]),{protocol:n,slashes:i||_e(n),slashesCount:s,rest:a}}function Cl(t,e){if(t==="")return e;for(var r=(e||"/").split("/").slice(0,-1).concat(t.split("/")),n=r.length,i=r[n-1],o=!1,s=0;n--;)r[n]==="."?r.splice(n,1):r[n]===".."?(r.splice(n,1),s++):s&&(n===0&&(o=!0),r.splice(n,1),s--);return o&&r.unshift(""),(i==="."||i==="..")&&r.push(""),r.join("/")}function Se(t,e,r){if(t=cn(t),t=t.replace(Bi,""),!(this instanceof Se))return new Se(t,e,r);var n,i,o,s,a,l,c=Kr.slice(),f=typeof e,p=this,v=0;for(f!=="object"&&f!=="string"&&(r=e,e=null),r&&typeof r!="function"&&(r=yr.parse),e=Di(e),i=Gi(t||"",e),n=!i.protocol&&!i.slashes,p.slashes=i.slashes||n&&e.slashes,p.protocol=i.protocol||e.protocol||"",t=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||$l.test(t))||!i.slashes&&(i.protocol||i.slashesCount<2||!_e(p.protocol)))&&(c[3]=[/(.*)/,"pathname"]);v<c.length;v++){if(s=c[v],typeof s=="function"){t=s(t,p);continue}o=s[0],l=s[1],o!==o?p[l]=t:typeof o=="string"?(a=o==="@"?t.lastIndexOf(o):t.indexOf(o),~a&&(typeof s[2]=="number"?(p[l]=t.slice(0,a),t=t.slice(a+s[2])):(p[l]=t.slice(a),t=t.slice(0,a)))):(a=o.exec(t))&&(p[l]=a[1],t=t.slice(0,a.index)),p[l]=p[l]||n&&s[3]&&e[l]||"",s[4]&&(p[l]=p[l].toLowerCase())}r&&(p.query=r(p.query)),n&&e.slashes&&p.pathname.charAt(0)!=="/"&&(p.pathname!==""||e.pathname!=="")&&(p.pathname=Cl(p.pathname,e.pathname)),p.pathname.charAt(0)!=="/"&&_e(p.protocol)&&(p.pathname="/"+p.pathname),zi(p.port,p.protocol)||(p.host=p.hostname,p.port=""),p.username=p.password="",p.auth&&(a=p.auth.indexOf(":"),~a?(p.username=p.auth.slice(0,a),p.username=encodeURIComponent(decodeURIComponent(p.username)),p.password=p.auth.slice(a+1),p.password=encodeURIComponent(decodeURIComponent(p.password))):p.username=encodeURIComponent(decodeURIComponent(p.auth)),p.auth=p.password?p.username+":"+p.password:p.username),p.origin=p.protocol!=="file:"&&_e(p.protocol)&&p.host?p.protocol+"//"+p.host:"null",p.href=p.toString()}function jl(t,e,r){var n=this;switch(t){case"query":typeof e=="string"&&e.length&&(e=(r||yr.parse)(e)),n[t]=e;break;case"port":n[t]=e,zi(e,n.protocol)?e&&(n.host=n.hostname+":"+e):(n.host=n.hostname,n[t]="");break;case"hostname":n[t]=e,n.port&&(e+=":"+n.port),n.host=e;break;case"host":n[t]=e,Hi.test(e)?(e=e.split(":"),n.port=e.pop(),n.hostname=e.join(":")):(n.hostname=e,n.port="");break;case"protocol":n.protocol=e.toLowerCase(),n.slashes=!r;break;case"pathname":case"hash":if(e){var i=t==="pathname"?"/":"#";n[t]=e.charAt(0)!==i?i+e:e}else n[t]=e;break;case"username":case"password":n[t]=encodeURIComponent(e);break;case"auth":var o=e.indexOf(":");~o?(n.username=e.slice(0,o),n.username=encodeURIComponent(decodeURIComponent(n.username)),n.password=e.slice(o+1),n.password=encodeURIComponent(decodeURIComponent(n.password))):n.username=encodeURIComponent(decodeURIComponent(e))}for(var s=0;s<Kr.length;s++){var a=Kr[s];a[4]&&(n[a[1]]=n[a[1]].toLowerCase())}return n.auth=n.password?n.username+":"+n.password:n.username,n.origin=n.protocol!=="file:"&&_e(n.protocol)&&n.host?n.protocol+"//"+n.host:"null",n.href=n.toString(),n}function kl(t){(!t||typeof t!="function")&&(t=yr.stringify);var e,r=this,n=r.host,i=r.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var o=i+(r.protocol&&r.slashes||_e(r.protocol)?"//":"");return r.username?(o+=r.username,r.password&&(o+=":"+r.password),o+="@"):r.password?(o+=":"+r.password,o+="@"):r.protocol!=="file:"&&_e(r.protocol)&&!n&&r.pathname!=="/"&&(o+="@"),(n[n.length-1]===":"||Hi.test(r.hostname)&&!r.port)&&(n+=":"),o+=n+r.pathname,e=typeof r.query=="object"?t(r.query):r.query,e&&(o+=e.charAt(0)!=="?"?"?"+e:e),r.hash&&(o+=r.hash),o}Se.prototype={set:jl,toString:kl};Se.extractProtocol=Gi;Se.location=Di;Se.trimLeft=cn;Se.qs=yr;var Al=Se;const Ll=dt(Al);function Il(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,r=t==="x"?e:e&3|8;return r.toString(16)})}function Wr(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Wr=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(h,u,d){h[u]=d.value},o=typeof Symbol=="function"?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(h,u,d){return Object.defineProperty(h,u,{value:d,enumerable:!0,configurable:!0,writable:!0}),h[u]}try{c({},"")}catch{c=function(d,m,y){return d[m]=y}}function f(h,u,d,m){var y=u&&u.prototype instanceof P?u:P,g=Object.create(y.prototype),$=new ue(m||[]);return i(g,"_invoke",{value:be(h,d,$)}),g}function p(h,u,d){try{return{type:"normal",arg:h.call(u,d)}}catch(m){return{type:"throw",arg:m}}}e.wrap=f;var v="suspendedStart",w="suspendedYield",U="executing",O="completed",b={};function P(){}function x(){}function j(){}var k={};c(k,s,function(){return this});var N=Object.getPrototypeOf,C=N&&N(N(we([])));C&&C!==r&&n.call(C,s)&&(k=C);var R=j.prototype=P.prototype=Object.create(k);function I(h){["next","throw","return"].forEach(function(u){c(h,u,function(d){return this._invoke(u,d)})})}function q(h,u){function d(y,g,$,A){var L=p(h[y],h,g);if(L.type!=="throw"){var Q=L.arg,D=Q.value;return D&&tt(D)=="object"&&n.call(D,"__await")?u.resolve(D.__await).then(function(Z){d("next",Z,$,A)},function(Z){d("throw",Z,$,A)}):u.resolve(D).then(function(Z){Q.value=Z,$(Q)},function(Z){return d("throw",Z,$,A)})}A(L.arg)}var m;i(this,"_invoke",{value:function(g,$){function A(){return new u(function(L,Q){d(g,$,L,Q)})}return m=m?m.then(A,A):A()}})}function be(h,u,d){var m=v;return function(y,g){if(m===U)throw Error("Generator is already running");if(m===O){if(y==="throw")throw g;return{value:t,done:!0}}for(d.method=y,d.arg=g;;){var $=d.delegate;if($){var A=ke($,d);if(A){if(A===b)continue;return A}}if(d.method==="next")d.sent=d._sent=d.arg;else if(d.method==="throw"){if(m===v)throw m=O,d.arg;d.dispatchException(d.arg)}else d.method==="return"&&d.abrupt("return",d.arg);m=U;var L=p(h,u,d);if(L.type==="normal"){if(m=d.done?O:w,L.arg===b)continue;return{value:L.arg,done:d.done}}L.type==="throw"&&(m=O,d.method="throw",d.arg=L.arg)}}}function ke(h,u){var d=u.method,m=h.iterator[d];if(m===t)return u.delegate=null,d==="throw"&&h.iterator.return&&(u.method="return",u.arg=t,ke(h,u),u.method==="throw")||d!=="return"&&(u.method="throw",u.arg=new TypeError("The iterator does not provide a '"+d+"' method")),b;var y=p(m,h.iterator,u.arg);if(y.type==="throw")return u.method="throw",u.arg=y.arg,u.delegate=null,b;var g=y.arg;return g?g.done?(u[h.resultName]=g.value,u.next=h.nextLoc,u.method!=="return"&&(u.method="next",u.arg=t),u.delegate=null,b):g:(u.method="throw",u.arg=new TypeError("iterator result is not an object"),u.delegate=null,b)}function ft(h){var u={tryLoc:h[0]};1 in h&&(u.catchLoc=h[1]),2 in h&&(u.finallyLoc=h[2],u.afterLoc=h[3]),this.tryEntries.push(u)}function ge(h){var u=h.completion||{};u.type="normal",delete u.arg,h.completion=u}function ue(h){this.tryEntries=[{tryLoc:"root"}],h.forEach(ft,this),this.reset(!0)}function we(h){if(h||h===""){var u=h[s];if(u)return u.call(h);if(typeof h.next=="function")return h;if(!isNaN(h.length)){var d=-1,m=function y(){for(;++d<h.length;)if(n.call(h,d))return y.value=h[d],y.done=!1,y;return y.value=t,y.done=!0,y};return m.next=m}}throw new TypeError(tt(h)+" is not iterable")}return x.prototype=j,i(R,"constructor",{value:j,configurable:!0}),i(j,"constructor",{value:x,configurable:!0}),x.displayName=c(j,l,"GeneratorFunction"),e.isGeneratorFunction=function(h){var u=typeof h=="function"&&h.constructor;return!!u&&(u===x||(u.displayName||u.name)==="GeneratorFunction")},e.mark=function(h){return Object.setPrototypeOf?Object.setPrototypeOf(h,j):(h.__proto__=j,c(h,l,"GeneratorFunction")),h.prototype=Object.create(R),h},e.awrap=function(h){return{__await:h}},I(q.prototype),c(q.prototype,a,function(){return this}),e.AsyncIterator=q,e.async=function(h,u,d,m,y){y===void 0&&(y=Promise);var g=new q(f(h,u,d,m),y);return e.isGeneratorFunction(u)?g:g.next().then(function($){return $.done?$.value:g.next()})},I(R),c(R,l,"Generator"),c(R,s,function(){return this}),c(R,"toString",function(){return"[object Generator]"}),e.keys=function(h){var u=Object(h),d=[];for(var m in u)d.push(m);return d.reverse(),function y(){for(;d.length;){var g=d.pop();if(g in u)return y.value=g,y.done=!1,y}return y.done=!0,y}},e.values=we,ue.prototype={constructor:ue,reset:function(u){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(ge),!u)for(var d in this)d.charAt(0)==="t"&&n.call(this,d)&&!isNaN(+d.slice(1))&&(this[d]=t)},stop:function(){this.done=!0;var u=this.tryEntries[0].completion;if(u.type==="throw")throw u.arg;return this.rval},dispatchException:function(u){if(this.done)throw u;var d=this;function m(Q,D){return $.type="throw",$.arg=u,d.next=Q,D&&(d.method="next",d.arg=t),!!D}for(var y=this.tryEntries.length-1;y>=0;--y){var g=this.tryEntries[y],$=g.completion;if(g.tryLoc==="root")return m("end");if(g.tryLoc<=this.prev){var A=n.call(g,"catchLoc"),L=n.call(g,"finallyLoc");if(A&&L){if(this.prev<g.catchLoc)return m(g.catchLoc,!0);if(this.prev<g.finallyLoc)return m(g.finallyLoc)}else if(A){if(this.prev<g.catchLoc)return m(g.catchLoc,!0)}else{if(!L)throw Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return m(g.finallyLoc)}}}},abrupt:function(u,d){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.tryLoc<=this.prev&&n.call(y,"finallyLoc")&&this.prev<y.finallyLoc){var g=y;break}}g&&(u==="break"||u==="continue")&&g.tryLoc<=d&&d<=g.finallyLoc&&(g=null);var $=g?g.completion:{};return $.type=u,$.arg=d,g?(this.method="next",this.next=g.finallyLoc,b):this.complete($)},complete:function(u,d){if(u.type==="throw")throw u.arg;return u.type==="break"||u.type==="continue"?this.next=u.arg:u.type==="return"?(this.rval=this.arg=u.arg,this.method="return",this.next="end"):u.type==="normal"&&d&&(this.next=d),b},finish:function(u){for(var d=this.tryEntries.length-1;d>=0;--d){var m=this.tryEntries[d];if(m.finallyLoc===u)return this.complete(m.completion,m.afterLoc),ge(m),b}},catch:function(u){for(var d=this.tryEntries.length-1;d>=0;--d){var m=this.tryEntries[d];if(m.tryLoc===u){var y=m.completion;if(y.type==="throw"){var g=y.arg;ge(m)}return g}}throw Error("illegal catch attempt")},delegateYield:function(u,d,m){return this.delegate={iterator:we(u),resultName:d,nextLoc:m},this.method==="next"&&(this.arg=t),b}},e}function Mn(t,e,r,n,i,o,s){try{var a=t[o](s),l=a.value}catch(c){r(c);return}a.done?e(l):Promise.resolve(l).then(n,i)}function Ml(t){return function(){var e=this,r=arguments;return new Promise(function(n,i){var o=t.apply(e,r);function s(l){Mn(o,n,i,s,a,"next",l)}function a(l){Mn(o,n,i,s,a,"throw",l)}s(void 0)})}}function Ki(t,e){return zl(t)||Nl(t,e)||Wi(t,e)||ql()}function ql(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Nl(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,o,s,a=[],l=!0,c=!1;try{if(o=(r=r.call(t)).next,e===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(a.push(n.value),a.length!==e);l=!0);}catch(f){c=!0,i=f}finally{try{if(!l&&r.return!=null&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw i}}return a}}function zl(t){if(Array.isArray(t))return t}function tt(t){"@babel/helpers - typeof";return tt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tt(t)}function Bl(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Wi(t))||e&&t&&typeof t.length=="number"){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,s=!1,a;return{s:function(){r=r.call(t)},n:function(){var c=r.next();return o=c.done,c},e:function(c){s=!0,a=c},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(s)throw a}}}}function Wi(t,e){if(t){if(typeof t=="string")return qn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qn(t,e)}}function qn(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Nn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function nt(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Nn(Object(r),!0).forEach(function(n){Hl(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Nn(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Hl(t,e,r){return e=Xi(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Dl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function zn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Xi(n.key),n)}}function Gl(t,e,r){return e&&zn(t.prototype,e),r&&zn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Xi(t){var e=Kl(t,"string");return tt(e)=="symbol"?e:e+""}function Kl(t,e){if(tt(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(tt(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Xr="tus-v1",dr="ietf-draft-03",Wl={endpoint:null,uploadUrl:null,metadata:{},metadataForPartialUploads:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:Vi,chunkSize:Number.POSITIVE_INFINITY,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null,protocol:Xr},pr=function(){function t(e,r){Dl(this,t),"resume"in r&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=r,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=e,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}return Gl(t,[{key:"findPreviousUploads",value:function(){var r=this;return this.options.fingerprint(this.file,this.options).then(function(n){return r._urlStorage.findUploadsByFingerprint(n)})}},{key:"resumeFromPreviousUpload",value:function(r){this.url=r.uploadUrl||null,this._parallelUploadUrls=r.parallelUploadUrls||null,this._urlStorageKey=r.urlStorageKey}},{key:"start",value:function(){var r=this,n=this.file;if(!n){this._emitError(new Error("tus: no file or stream to upload provided"));return}if(![Xr,dr].includes(this.options.protocol)){this._emitError(new Error("tus: unsupported protocol ".concat(this.options.protocol)));return}if(!this.options.endpoint&&!this.options.uploadUrl&&!this.url){this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));return}var i=this.options.retryDelays;if(i!=null&&Object.prototype.toString.call(i)!=="[object Array]"){this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"));return}if(this.options.parallelUploads>1)for(var o=0,s=["uploadUrl","uploadSize","uploadLengthDeferred"];o<s.length;o++){var a=s[o];if(this.options[a]){this._emitError(new Error("tus: cannot use the ".concat(a," option when parallelUploads is enabled")));return}}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1){this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));return}if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length){this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"));return}}this.options.fingerprint(n,this.options).then(function(l){return r._fingerprint=l,r._source?r._source:r.options.fileReader.openFile(n,r.options.chunkSize)}).then(function(l){if(r._source=l,r.options.uploadLengthDeferred)r._size=null;else if(r.options.uploadSize!=null){if(r._size=Number(r.options.uploadSize),Number.isNaN(r._size)){r._emitError(new Error("tus: cannot convert `uploadSize` option into a number"));return}}else if(r._size=r._source.size,r._size==null){r._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));return}r.options.parallelUploads>1||r._parallelUploadUrls!=null?r._startParallelUpload():r._startSingleUpload()}).catch(function(l){r._emitError(l)})}},{key:"_startParallelUpload",value:function(){var r,n=this,i=this._size,o=0;this._parallelUploads=[];var s=this._parallelUploadUrls!=null?this._parallelUploadUrls.length:this.options.parallelUploads,a=(r=this.options.parallelUploadBoundaries)!==null&&r!==void 0?r:Vl(this._source.size,s);this._parallelUploadUrls&&a.forEach(function(f,p){f.uploadUrl=n._parallelUploadUrls[p]||null}),this._parallelUploadUrls=new Array(a.length);var l=a.map(function(f,p){var v=0;return n._source.slice(f.start,f.end).then(function(w){var U=w.value;return new Promise(function(O,b){var P=nt(nt({},n.options),{},{uploadUrl:f.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:n.options.metadataForPartialUploads,headers:nt(nt({},n.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:O,onError:b,onProgress:function(k){o=o-v+k,v=k,n._emitProgress(o,i)},onUploadUrlAvailable:function(){n._parallelUploadUrls[p]=x.url,n._parallelUploadUrls.filter(function(k){return!!k}).length===a.length&&n._saveUploadInUrlStorage()}}),x=new t(U,P);x.start(),n._parallelUploads.push(x)})})}),c;Promise.all(l).then(function(){c=n._openRequest("POST",n.options.endpoint),c.setHeader("Upload-Concat","final;".concat(n._parallelUploadUrls.join(" ")));var f=Bn(n.options.metadata);return f!==""&&c.setHeader("Upload-Metadata",f),n._sendRequest(c,null)}).then(function(f){if(!ot(f.getStatus(),200)){n._emitHttpError(c,f,"tus: unexpected response while creating upload");return}var p=f.getHeader("Location");if(p==null){n._emitHttpError(c,f,"tus: invalid or missing Location header");return}n.url=Kn(n.options.endpoint,p),"Created upload at ".concat(n.url),n._emitSuccess(f)}).catch(function(f){n._emitError(f)})}},{key:"_startSingleUpload",value:function(){if(this._aborted=!1,this.url!=null){"Resuming upload from previous URL: ".concat(this.url),this._resumeUpload();return}if(this.options.uploadUrl!=null){"Resuming upload from provided URL: ".concat(this.options.uploadUrl),this.url=this.options.uploadUrl,this._resumeUpload();return}this._createUpload()}},{key:"abort",value:function(r){var n=this;if(this._parallelUploads!=null){var i=Bl(this._parallelUploads),o;try{for(i.s();!(o=i.n()).done;){var s=o.value;s.abort(r)}}catch(a){i.e(a)}finally{i.f()}}return this._req!==null&&this._req.abort(),this._aborted=!0,this._retryTimeout!=null&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),!r||this.url==null?Promise.resolve():t.terminate(this.url,this.options).then(function(){return n._removeFromUrlStorage()})}},{key:"_emitHttpError",value:function(r,n,i,o){this._emitError(new or(i,o,r,n))}},{key:"_emitError",value:function(r){var n=this;if(!this._aborted){if(this.options.retryDelays!=null){var i=this._offset!=null&&this._offset>this._offsetBeforeRetry;if(i&&(this._retryAttempt=0),Gn(r,this._retryAttempt,this.options)){var o=this.options.retryDelays[this._retryAttempt++];this._offsetBeforeRetry=this._offset,this._retryTimeout=setTimeout(function(){n.start()},o);return}}if(typeof this.options.onError=="function")this.options.onError(r);else throw r}}},{key:"_emitSuccess",value:function(r){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),typeof this.options.onSuccess=="function"&&this.options.onSuccess({lastResponse:r})}},{key:"_emitProgress",value:function(r,n){typeof this.options.onProgress=="function"&&this.options.onProgress(r,n)}},{key:"_emitChunkComplete",value:function(r,n,i){typeof this.options.onChunkComplete=="function"&&this.options.onChunkComplete(r,n,i)}},{key:"_createUpload",value:function(){var r=this;if(!this.options.endpoint){this._emitError(new Error("tus: unable to create upload because no endpoint is provided"));return}var n=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?n.setHeader("Upload-Defer-Length","1"):n.setHeader("Upload-Length","".concat(this._size));var i=Bn(this.options.metadata);i!==""&&n.setHeader("Upload-Metadata",i);var o;this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,o=this._addChunkToRequest(n)):(this.options.protocol===dr&&n.setHeader("Upload-Complete","?0"),o=this._sendRequest(n,null)),o.then(function(s){if(!ot(s.getStatus(),200)){r._emitHttpError(n,s,"tus: unexpected response while creating upload");return}var a=s.getHeader("Location");if(a==null){r._emitHttpError(n,s,"tus: invalid or missing Location header");return}if(r.url=Kn(r.options.endpoint,a),"Created upload at ".concat(r.url),typeof r.options.onUploadUrlAvailable=="function"&&r.options.onUploadUrlAvailable(),r._size===0){r._emitSuccess(s),r._source.close();return}r._saveUploadInUrlStorage().then(function(){r.options.uploadDataDuringCreation?r._handleUploadResponse(n,s):(r._offset=0,r._performUpload())})}).catch(function(s){r._emitHttpError(n,null,"tus: failed to create upload",s)})}},{key:"_resumeUpload",value:function(){var r=this,n=this._openRequest("HEAD",this.url),i=this._sendRequest(n,null);i.then(function(o){var s=o.getStatus();if(!ot(s,200)){if(s===423){r._emitHttpError(n,o,"tus: upload is currently locked; retry later");return}if(ot(s,400)&&r._removeFromUrlStorage(),!r.options.endpoint){r._emitHttpError(n,o,"tus: unable to resume upload (new upload cannot be created without an endpoint)");return}r.url=null,r._createUpload();return}var a=Number.parseInt(o.getHeader("Upload-Offset"),10);if(Number.isNaN(a)){r._emitHttpError(n,o,"tus: invalid or missing offset value");return}var l=Number.parseInt(o.getHeader("Upload-Length"),10);if(Number.isNaN(l)&&!r.options.uploadLengthDeferred&&r.options.protocol===Xr){r._emitHttpError(n,o,"tus: invalid or missing length value");return}typeof r.options.onUploadUrlAvailable=="function"&&r.options.onUploadUrlAvailable(),r._saveUploadInUrlStorage().then(function(){if(a===l){r._emitProgress(l,l),r._emitSuccess(o);return}r._offset=a,r._performUpload()})}).catch(function(o){r._emitHttpError(n,null,"tus: failed to resume upload",o)})}},{key:"_performUpload",value:function(){var r=this;if(!this._aborted){var n;this.options.overridePatchMethod?(n=this._openRequest("POST",this.url),n.setHeader("X-HTTP-Method-Override","PATCH")):n=this._openRequest("PATCH",this.url),n.setHeader("Upload-Offset","".concat(this._offset));var i=this._addChunkToRequest(n);i.then(function(o){if(!ot(o.getStatus(),200)){r._emitHttpError(n,o,"tus: unexpected response while uploading chunk");return}r._handleUploadResponse(n,o)}).catch(function(o){r._aborted||r._emitHttpError(n,null,"tus: failed to upload chunk at offset ".concat(r._offset),o)})}}},{key:"_addChunkToRequest",value:function(r){var n=this,i=this._offset,o=this._offset+this.options.chunkSize;return r.setProgressHandler(function(s){n._emitProgress(i+s,n._size)}),r.setHeader("Content-Type","application/offset+octet-stream"),(o===Number.POSITIVE_INFINITY||o>this._size)&&!this.options.uploadLengthDeferred&&(o=this._size),this._source.slice(i,o).then(function(s){var a=s.value,l=s.done,c=a!=null&&a.size?a.size:0;n.options.uploadLengthDeferred&&l&&(n._size=n._offset+c,r.setHeader("Upload-Length","".concat(n._size)));var f=n._offset+c;return!n.options.uploadLengthDeferred&&l&&f!==n._size?Promise.reject(new Error("upload was configured with a size of ".concat(n._size," bytes, but the source is done after ").concat(f," bytes"))):a===null?n._sendRequest(r):(n.options.protocol===dr&&r.setHeader("Upload-Complete",l?"?1":"?0"),n._emitProgress(n._offset,n._size),n._sendRequest(r,a))})}},{key:"_handleUploadResponse",value:function(r,n){var i=Number.parseInt(n.getHeader("Upload-Offset"),10);if(Number.isNaN(i)){this._emitHttpError(r,n,"tus: invalid or missing offset value");return}if(this._emitProgress(i,this._size),this._emitChunkComplete(i-this._offset,i,this._size),this._offset=i,i===this._size){this._emitSuccess(n),this._source.close();return}this._performUpload()}},{key:"_openRequest",value:function(r,n){var i=Hn(r,n,this.options);return this._req=i,i}},{key:"_removeFromUrlStorage",value:function(){var r=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch(function(n){r._emitError(n)}),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var r=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||this._urlStorageKey!==null)return Promise.resolve();var n={size:this._size,metadata:this.options.metadata,creationTime:new Date().toString()};return this._parallelUploads?n.parallelUploadUrls=this._parallelUploadUrls:n.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,n).then(function(i){r._urlStorageKey=i})}},{key:"_sendRequest",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return Dn(r,n,this.options)}}],[{key:"terminate",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=Hn("DELETE",r,n);return Dn(i,null,n).then(function(o){if(o.getStatus()!==204)throw new or("tus: unexpected response while terminating upload",null,i,o)}).catch(function(o){if(o instanceof or||(o=new or("tus: failed to terminate upload",o,i,null)),!Gn(o,0,n))throw o;var s=n.retryDelays[0],a=n.retryDelays.slice(1),l=nt(nt({},n),{},{retryDelays:a});return new Promise(function(c){return setTimeout(c,s)}).then(function(){return t.terminate(r,l)})})}}])}();function Bn(t){return Object.entries(t).map(function(e){var r=Ki(e,2),n=r[0],i=r[1];return"".concat(n," ").concat(Sl.encode(String(i)))}).join(",")}function ot(t,e){return t>=e&&t<e+100}function Hn(t,e,r){var n=r.httpStack.createRequest(t,e);r.protocol===dr?n.setHeader("Upload-Draft-Interop-Version","5"):n.setHeader("Tus-Resumable","1.0.0");for(var i=r.headers||{},o=0,s=Object.entries(i);o<s.length;o++){var a=Ki(s[o],2),l=a[0],c=a[1];n.setHeader(l,c)}if(r.addRequestId){var f=Il();n.setHeader("X-Request-ID",f)}return n}function Dn(t,e,r){return Vr.apply(this,arguments)}function Vr(){return Vr=Ml(Wr().mark(function t(e,r,n){var i;return Wr().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(typeof n.onBeforeRequest!="function"){s.next=3;break}return s.next=3,n.onBeforeRequest(e);case 3:return s.next=5,e.send(r);case 5:if(i=s.sent,typeof n.onAfterResponse!="function"){s.next=9;break}return s.next=9,n.onAfterResponse(e,i);case 9:return s.abrupt("return",i);case 10:case"end":return s.stop()}},t)})),Vr.apply(this,arguments)}function Xl(){var t=!0;return typeof navigator<"u"&&navigator.onLine===!1&&(t=!1),t}function Gn(t,e,r){return r.retryDelays==null||e>=r.retryDelays.length||t.originalRequest==null?!1:r&&typeof r.onShouldRetry=="function"?r.onShouldRetry(t,e,r):Vi(t)}function Vi(t){var e=t.originalResponse?t.originalResponse.getStatus():0;return(!ot(e,400)||e===409||e===423)&&Xl()}function Kn(t,e){return new Ll(e,t).toString()}function Vl(t,e){for(var r=Math.floor(t/e),n=[],i=0;i<e;i++)n.push({start:r*i,end:r*(i+1)});return n[e-1].end=t,n}pr.defaultOptions=Wl;var Yi=function(){return typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative"};function Yl(t){return new Promise(function(e,r){var n=new XMLHttpRequest;n.responseType="blob",n.onload=function(){var i=n.response;e(i)},n.onerror=function(i){r(i)},n.open("GET",t),n.send()})}var Jl=function(){return typeof window<"u"&&(typeof window.PhoneGap<"u"||typeof window.Cordova<"u"||typeof window.cordova<"u")};function Ql(t){return new Promise(function(e,r){var n=new FileReader;n.onload=function(){var i=new Uint8Array(n.result);e({value:i})},n.onerror=function(i){r(i)},n.readAsArrayBuffer(t)})}function Jt(t){"@babel/helpers - typeof";return Jt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jt(t)}function Zl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Wn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tu(n.key),n)}}function eu(t,e,r){return e&&Wn(t.prototype,e),r&&Wn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function tu(t){var e=ru(t,"string");return Jt(e)=="symbol"?e:e+""}function ru(t,e){if(Jt(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(Jt(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Xn=function(){function t(e){Zl(this,t),this._file=e,this.size=e.size}return eu(t,[{key:"slice",value:function(r,n){if(Jl())return Ql(this._file.slice(r,n));var i=this._file.slice(r,n),o=n>=this.size;return Promise.resolve({value:i,done:o})}},{key:"close",value:function(){}}])}();function Qt(t){"@babel/helpers - typeof";return Qt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qt(t)}function nu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ou(n.key),n)}}function iu(t,e,r){return e&&Vn(t.prototype,e),r&&Vn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function ou(t){var e=su(t,"string");return Qt(e)=="symbol"?e:e+""}function su(t,e){if(Qt(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(Qt(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Yn(t){return t===void 0?0:t.size!==void 0?t.size:t.length}function au(t,e){if(t.concat)return t.concat(e);if(t instanceof Blob)return new Blob([t,e],{type:t.type});if(t.set){var r=new t.constructor(t.length+e.length);return r.set(t),r.set(e,t.length),r}throw new Error("Unknown data type")}var lu=function(){function t(e){nu(this,t),this._buffer=void 0,this._bufferOffset=0,this._reader=e,this._done=!1}return iu(t,[{key:"slice",value:function(r,n){return r<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(r,n)}},{key:"_readUntilEnoughDataOrDone",value:function(r,n){var i=this,o=n<=this._bufferOffset+Yn(this._buffer);if(this._done||o){var s=this._getDataFromBuffer(r,n),a=s==null?this._done:!1;return Promise.resolve({value:s,done:a})}return this._reader.read().then(function(l){var c=l.value,f=l.done;return f?i._done=!0:i._buffer===void 0?i._buffer=c:i._buffer=au(i._buffer,c),i._readUntilEnoughDataOrDone(r,n)})}},{key:"_getDataFromBuffer",value:function(r,n){r>this._bufferOffset&&(this._buffer=this._buffer.slice(r-this._bufferOffset),this._bufferOffset=r);var i=Yn(this._buffer)===0;return this._done&&i?null:this._buffer.slice(0,n-r)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}])}();function rt(t){"@babel/helpers - typeof";return rt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rt(t)}function Yr(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Yr=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(h,u,d){h[u]=d.value},o=typeof Symbol=="function"?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(h,u,d){return Object.defineProperty(h,u,{value:d,enumerable:!0,configurable:!0,writable:!0}),h[u]}try{c({},"")}catch{c=function(d,m,y){return d[m]=y}}function f(h,u,d,m){var y=u&&u.prototype instanceof P?u:P,g=Object.create(y.prototype),$=new ue(m||[]);return i(g,"_invoke",{value:be(h,d,$)}),g}function p(h,u,d){try{return{type:"normal",arg:h.call(u,d)}}catch(m){return{type:"throw",arg:m}}}e.wrap=f;var v="suspendedStart",w="suspendedYield",U="executing",O="completed",b={};function P(){}function x(){}function j(){}var k={};c(k,s,function(){return this});var N=Object.getPrototypeOf,C=N&&N(N(we([])));C&&C!==r&&n.call(C,s)&&(k=C);var R=j.prototype=P.prototype=Object.create(k);function I(h){["next","throw","return"].forEach(function(u){c(h,u,function(d){return this._invoke(u,d)})})}function q(h,u){function d(y,g,$,A){var L=p(h[y],h,g);if(L.type!=="throw"){var Q=L.arg,D=Q.value;return D&&rt(D)=="object"&&n.call(D,"__await")?u.resolve(D.__await).then(function(Z){d("next",Z,$,A)},function(Z){d("throw",Z,$,A)}):u.resolve(D).then(function(Z){Q.value=Z,$(Q)},function(Z){return d("throw",Z,$,A)})}A(L.arg)}var m;i(this,"_invoke",{value:function(g,$){function A(){return new u(function(L,Q){d(g,$,L,Q)})}return m=m?m.then(A,A):A()}})}function be(h,u,d){var m=v;return function(y,g){if(m===U)throw Error("Generator is already running");if(m===O){if(y==="throw")throw g;return{value:t,done:!0}}for(d.method=y,d.arg=g;;){var $=d.delegate;if($){var A=ke($,d);if(A){if(A===b)continue;return A}}if(d.method==="next")d.sent=d._sent=d.arg;else if(d.method==="throw"){if(m===v)throw m=O,d.arg;d.dispatchException(d.arg)}else d.method==="return"&&d.abrupt("return",d.arg);m=U;var L=p(h,u,d);if(L.type==="normal"){if(m=d.done?O:w,L.arg===b)continue;return{value:L.arg,done:d.done}}L.type==="throw"&&(m=O,d.method="throw",d.arg=L.arg)}}}function ke(h,u){var d=u.method,m=h.iterator[d];if(m===t)return u.delegate=null,d==="throw"&&h.iterator.return&&(u.method="return",u.arg=t,ke(h,u),u.method==="throw")||d!=="return"&&(u.method="throw",u.arg=new TypeError("The iterator does not provide a '"+d+"' method")),b;var y=p(m,h.iterator,u.arg);if(y.type==="throw")return u.method="throw",u.arg=y.arg,u.delegate=null,b;var g=y.arg;return g?g.done?(u[h.resultName]=g.value,u.next=h.nextLoc,u.method!=="return"&&(u.method="next",u.arg=t),u.delegate=null,b):g:(u.method="throw",u.arg=new TypeError("iterator result is not an object"),u.delegate=null,b)}function ft(h){var u={tryLoc:h[0]};1 in h&&(u.catchLoc=h[1]),2 in h&&(u.finallyLoc=h[2],u.afterLoc=h[3]),this.tryEntries.push(u)}function ge(h){var u=h.completion||{};u.type="normal",delete u.arg,h.completion=u}function ue(h){this.tryEntries=[{tryLoc:"root"}],h.forEach(ft,this),this.reset(!0)}function we(h){if(h||h===""){var u=h[s];if(u)return u.call(h);if(typeof h.next=="function")return h;if(!isNaN(h.length)){var d=-1,m=function y(){for(;++d<h.length;)if(n.call(h,d))return y.value=h[d],y.done=!1,y;return y.value=t,y.done=!0,y};return m.next=m}}throw new TypeError(rt(h)+" is not iterable")}return x.prototype=j,i(R,"constructor",{value:j,configurable:!0}),i(j,"constructor",{value:x,configurable:!0}),x.displayName=c(j,l,"GeneratorFunction"),e.isGeneratorFunction=function(h){var u=typeof h=="function"&&h.constructor;return!!u&&(u===x||(u.displayName||u.name)==="GeneratorFunction")},e.mark=function(h){return Object.setPrototypeOf?Object.setPrototypeOf(h,j):(h.__proto__=j,c(h,l,"GeneratorFunction")),h.prototype=Object.create(R),h},e.awrap=function(h){return{__await:h}},I(q.prototype),c(q.prototype,a,function(){return this}),e.AsyncIterator=q,e.async=function(h,u,d,m,y){y===void 0&&(y=Promise);var g=new q(f(h,u,d,m),y);return e.isGeneratorFunction(u)?g:g.next().then(function($){return $.done?$.value:g.next()})},I(R),c(R,l,"Generator"),c(R,s,function(){return this}),c(R,"toString",function(){return"[object Generator]"}),e.keys=function(h){var u=Object(h),d=[];for(var m in u)d.push(m);return d.reverse(),function y(){for(;d.length;){var g=d.pop();if(g in u)return y.value=g,y.done=!1,y}return y.done=!0,y}},e.values=we,ue.prototype={constructor:ue,reset:function(u){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(ge),!u)for(var d in this)d.charAt(0)==="t"&&n.call(this,d)&&!isNaN(+d.slice(1))&&(this[d]=t)},stop:function(){this.done=!0;var u=this.tryEntries[0].completion;if(u.type==="throw")throw u.arg;return this.rval},dispatchException:function(u){if(this.done)throw u;var d=this;function m(Q,D){return $.type="throw",$.arg=u,d.next=Q,D&&(d.method="next",d.arg=t),!!D}for(var y=this.tryEntries.length-1;y>=0;--y){var g=this.tryEntries[y],$=g.completion;if(g.tryLoc==="root")return m("end");if(g.tryLoc<=this.prev){var A=n.call(g,"catchLoc"),L=n.call(g,"finallyLoc");if(A&&L){if(this.prev<g.catchLoc)return m(g.catchLoc,!0);if(this.prev<g.finallyLoc)return m(g.finallyLoc)}else if(A){if(this.prev<g.catchLoc)return m(g.catchLoc,!0)}else{if(!L)throw Error("try statement without catch or finally");if(this.prev<g.finallyLoc)return m(g.finallyLoc)}}}},abrupt:function(u,d){for(var m=this.tryEntries.length-1;m>=0;--m){var y=this.tryEntries[m];if(y.tryLoc<=this.prev&&n.call(y,"finallyLoc")&&this.prev<y.finallyLoc){var g=y;break}}g&&(u==="break"||u==="continue")&&g.tryLoc<=d&&d<=g.finallyLoc&&(g=null);var $=g?g.completion:{};return $.type=u,$.arg=d,g?(this.method="next",this.next=g.finallyLoc,b):this.complete($)},complete:function(u,d){if(u.type==="throw")throw u.arg;return u.type==="break"||u.type==="continue"?this.next=u.arg:u.type==="return"?(this.rval=this.arg=u.arg,this.method="return",this.next="end"):u.type==="normal"&&d&&(this.next=d),b},finish:function(u){for(var d=this.tryEntries.length-1;d>=0;--d){var m=this.tryEntries[d];if(m.finallyLoc===u)return this.complete(m.completion,m.afterLoc),ge(m),b}},catch:function(u){for(var d=this.tryEntries.length-1;d>=0;--d){var m=this.tryEntries[d];if(m.tryLoc===u){var y=m.completion;if(y.type==="throw"){var g=y.arg;ge(m)}return g}}throw Error("illegal catch attempt")},delegateYield:function(u,d,m){return this.delegate={iterator:we(u),resultName:d,nextLoc:m},this.method==="next"&&(this.arg=t),b}},e}function Jn(t,e,r,n,i,o,s){try{var a=t[o](s),l=a.value}catch(c){r(c);return}a.done?e(l):Promise.resolve(l).then(n,i)}function uu(t){return function(){var e=this,r=arguments;return new Promise(function(n,i){var o=t.apply(e,r);function s(l){Jn(o,n,i,s,a,"next",l)}function a(l){Jn(o,n,i,s,a,"throw",l)}s(void 0)})}}function cu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,pu(n.key),n)}}function du(t,e,r){return e&&Qn(t.prototype,e),r&&Qn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function pu(t){var e=fu(t,"string");return rt(e)=="symbol"?e:e+""}function fu(t,e){if(rt(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(rt(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var hu=function(){function t(){cu(this,t)}return du(t,[{key:"openFile",value:function(){var e=uu(Yr().mark(function n(i,o){var s;return Yr().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(Yi()&&i&&typeof i.uri<"u")){l.next=11;break}return l.prev=1,l.next=4,Yl(i.uri);case 4:return s=l.sent,l.abrupt("return",new Xn(s));case 8:throw l.prev=8,l.t0=l.catch(1),new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(l.t0));case 11:if(!(typeof i.slice=="function"&&typeof i.size<"u")){l.next=13;break}return l.abrupt("return",Promise.resolve(new Xn(i)));case 13:if(typeof i.read!="function"){l.next=18;break}if(o=Number(o),Number.isFinite(o)){l.next=17;break}return l.abrupt("return",Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option")));case 17:return l.abrupt("return",Promise.resolve(new lu(i,o)));case 18:return l.abrupt("return",Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment")));case 19:case"end":return l.stop()}},n,null,[[1,8]])}));function r(n,i){return e.apply(this,arguments)}return r}()}])}();function mu(t,e){return Yi()?Promise.resolve(gu(t,e)):Promise.resolve(["tus-br",t.name,t.type,t.size,t.lastModified,e.endpoint].join("-"))}function gu(t,e){var r=t.exif?yu(JSON.stringify(t.exif)):"noexif";return["tus-rn",t.name||"noname",t.size||"nosize",r,e.endpoint].join("/")}function yu(t){var e=0;if(t.length===0)return e;for(var r=0;r<t.length;r++){var n=t.charCodeAt(r);e=(e<<5)-e+n,e&=e}return e}function Zt(t){"@babel/helpers - typeof";return Zt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zt(t)}function dn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Zn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,vu(n.key),n)}}function pn(t,e,r){return e&&Zn(t.prototype,e),r&&Zn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function vu(t){var e=bu(t,"string");return Zt(e)=="symbol"?e:e+""}function bu(t,e){if(Zt(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(Zt(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var wu=function(){function t(){dn(this,t)}return pn(t,[{key:"createRequest",value:function(r,n){return new _u(r,n)}},{key:"getName",value:function(){return"XHRHttpStack"}}])}(),_u=function(){function t(e,r){dn(this,t),this._xhr=new XMLHttpRequest,this._xhr.open(e,r,!0),this._method=e,this._url=r,this._headers={}}return pn(t,[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(r,n){this._xhr.setRequestHeader(r,n),this._headers[r]=n}},{key:"getHeader",value:function(r){return this._headers[r]}},{key:"setProgressHandler",value:function(r){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(n){n.lengthComputable&&r(n.loaded)})}},{key:"send",value:function(){var r=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return new Promise(function(i,o){r._xhr.onload=function(){i(new Su(r._xhr))},r._xhr.onerror=function(s){o(s)},r._xhr.send(n)})}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}(),Su=function(){function t(e){dn(this,t),this._xhr=e}return pn(t,[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(r){return this._xhr.getResponseHeader(r)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}();function er(t){"@babel/helpers - typeof";return er=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},er(t)}function Pu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ei(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Eu(n.key),n)}}function Uu(t,e,r){return e&&ei(t.prototype,e),r&&ei(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Eu(t){var e=Ou(t,"string");return er(e)=="symbol"?e:e+""}function Ou(t,e){if(er(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(er(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Jr=!1;try{Jr="localStorage"in window;var Lr="tusSupport",ti=localStorage.getItem(Lr);localStorage.setItem(Lr,ti),ti===null&&localStorage.removeItem(Lr)}catch(t){if(t.code===t.SECURITY_ERR||t.code===t.QUOTA_EXCEEDED_ERR)Jr=!1;else throw t}var Fu=Jr,xu=function(){function t(){Pu(this,t)}return Uu(t,[{key:"findAllUploads",value:function(){var r=this._findEntries("tus::");return Promise.resolve(r)}},{key:"findUploadsByFingerprint",value:function(r){var n=this._findEntries("tus::".concat(r,"::"));return Promise.resolve(n)}},{key:"removeUpload",value:function(r){return localStorage.removeItem(r),Promise.resolve()}},{key:"addUpload",value:function(r,n){var i=Math.round(Math.random()*1e12),o="tus::".concat(r,"::").concat(i);return localStorage.setItem(o,JSON.stringify(n)),Promise.resolve(o)}},{key:"_findEntries",value:function(r){for(var n=[],i=0;i<localStorage.length;i++){var o=localStorage.key(i);if(o.indexOf(r)===0)try{var s=JSON.parse(localStorage.getItem(o));s.urlStorageKey=o,n.push(s)}catch{}}return n}}])}();function ct(t){"@babel/helpers - typeof";return ct=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ct(t)}function Ru(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ri(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Qi(n.key),n)}}function Tu(t,e,r){return e&&ri(t.prototype,e),r&&ri(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function $u(t,e,r){return e=fr(e),Cu(t,Ji()?Reflect.construct(e,r||[],fr(t).constructor):e.apply(t,r))}function Cu(t,e){if(e&&(ct(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ju(t)}function ju(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ji(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ji=function(){return!!t})()}function fr(t){return fr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},fr(t)}function ku(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qr(t,e)}function Qr(t,e){return Qr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Qr(t,e)}function ni(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function at(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ni(Object(r),!0).forEach(function(n){Au(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ni(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Au(t,e,r){return e=Qi(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Qi(t){var e=Lu(t,"string");return ct(e)=="symbol"?e:e+""}function Lu(t,e){if(ct(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(ct(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Zr=at(at({},pr.defaultOptions),{},{httpStack:new wu,fileReader:new hu,urlStorage:Fu?new xu:new dl,fingerprint:mu}),Iu=function(t){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ru(this,e),n=at(at({},Zr),n),$u(this,e,[r,n])}return ku(e,t),Tu(e,null,[{key:"terminate",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i=at(at({},Zr),i),pr.terminate(n,i)}}])}(pr);function Mu(t){return t?t.readyState!==0&&t.readyState!==4||t.status===0:!1}function qu(){return typeof window<"u"&&(typeof window.PhoneGap<"u"||typeof window.Cordova<"u"||typeof window.cordova<"u")}function Nu(){return typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative"}function zu(t){return(e,r)=>{if(qu()||Nu())return Zr.fingerprint(e,r);const n=["tus",t.id,r.endpoint].join("-");return Promise.resolve(n)}}function Ze(t,e){if(!{}.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var Bu=0;function tr(t){return"__private_"+Bu+++"_"+t}const Hu={version:"4.1.0"},Zi={endpoint:"",uploadUrl:null,metadata:{},uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,overridePatchMethod:!1,headers:{},addRequestId:!1,chunkSize:1/0,retryDelays:[100,1e3,3e3,5e3],parallelUploads:1,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1},Du={limit:20,retryDelays:Zi.retryDelays,withCredentials:!1,allowedMetaFields:!0};var Gt=tr("retryDelayIterator"),en=tr("uploadLocalFile"),tn=tr("getCompanionClientArgs"),Ir=tr("uploadFiles"),Lt=tr("handleUpload");class eo extends mi{constructor(e,r){var n,i;if(super(e,{...Du,...r}),Object.defineProperty(this,Ir,{value:Wu}),Object.defineProperty(this,tn,{value:Ku}),Object.defineProperty(this,en,{value:Gu}),Object.defineProperty(this,Gt,{writable:!0,value:void 0}),Object.defineProperty(this,Lt,{writable:!0,value:async o=>{if(o.length===0){this.uppy.log("[Tus] No files to upload");return}this.opts.limit===0&&this.uppy.log("[Tus] When uploading multiple files at once, consider setting the `limit` option (to `10` for example), to limit the number of concurrent uploads, which helps prevent memory and network issues: https://uppy.io/docs/tus/#limit-0","warning"),this.uppy.log("[Tus] Uploading...");const s=this.uppy.getFilesByIds(o);await Ze(this,Ir)[Ir](s)}}),this.type="uploader",this.id=this.opts.id||"Tus",(r==null?void 0:r.allowedMetaFields)===void 0&&"metaFields"in this.opts)throw new Error("The `metaFields` option has been renamed to `allowedMetaFields`.");if("autoRetry"in r)throw new Error("The `autoRetry` option was deprecated and has been removed.");this.requests=(n=this.opts.rateLimitedQueue)!=null?n:new Pi(this.opts.limit),Ze(this,Gt)[Gt]=(i=this.opts.retryDelays)==null?void 0:i.values(),this.uploaders=Object.create(null),this.uploaderEvents=Object.create(null)}resetUploaderReferences(e,r){const n=this.uploaders[e];n&&(n.abort(),r!=null&&r.abort&&n.abort(!0),this.uploaders[e]=null),this.uploaderEvents[e]&&(this.uploaderEvents[e].remove(),this.uploaderEvents[e]=null)}onReceiveUploadUrl(e,r){const n=this.uppy.getFile(e.id);n&&(!n.tus||n.tus.uploadUrl!==r)&&(this.uppy.log("[Tus] Storing upload url"),this.uppy.setFileState(n.id,{tus:{...n.tus,uploadUrl:r}}))}install(){this.uppy.setState({capabilities:{...this.uppy.getState().capabilities,resumableUploads:!0}}),this.uppy.addUploader(Ze(this,Lt)[Lt])}uninstall(){this.uppy.setState({capabilities:{...this.uppy.getState().capabilities,resumableUploads:!1}}),this.uppy.removeUploader(Ze(this,Lt)[Lt])}}function Gu(t){return this.resetUploaderReferences(t.id),new Promise((e,r)=>{let n,i,o;const s={...this.opts,...t.tus||{}};typeof s.headers=="function"&&(s.headers=s.headers(t));const{onShouldRetry:a,onBeforeRequest:l,...c}=s,f={...Zi,...c};f.fingerprint=zu(t),f.onBeforeRequest=async b=>{const P=b.getUnderlyingObject();P.withCredentials=!!s.withCredentials;let x;if(typeof l=="function"&&(x=l(b,t)),zt(n,"shouldBeRequeued")){if(!n.shouldBeRequeued)return Promise.reject();let j;const k=new Promise(N=>{j=N});n=this.requests.run(()=>(t.isPaused&&n.abort(),j(),()=>{})),await Promise.all([k,x]);return}return x},f.onError=b=>{var P;this.uppy.log(b);const x=b.originalRequest!=null?b.originalRequest.getUnderlyingObject():null;Mu(x)&&(b=new vi(b,x)),this.resetUploaderReferences(t.id),(P=n)==null||P.abort(),this.uppy.emit("upload-error",t,b),typeof s.onError=="function"&&s.onError(b),r(b)},f.onProgress=(b,P)=>{var x;this.onReceiveUploadUrl(t,o.url),typeof s.onProgress=="function"&&s.onProgress(b,P);const j=this.uppy.getFile(t.id);this.uppy.emit("upload-progress",j,{uploadStarted:(x=j.progress.uploadStarted)!=null?x:0,bytesUploaded:b,bytesTotal:P})},f.onSuccess=()=>{var b;const P={uploadURL:(b=o.url)!=null?b:void 0,status:200,body:{}};if(this.resetUploaderReferences(t.id),n.done(),this.uppy.emit("upload-success",this.uppy.getFile(t.id),P),o.url){const{name:x}=o.file;this.uppy.log(`Download ${x} from ${o.url}`)}typeof s.onSuccess=="function"&&s.onSuccess(),e(o)};const p=b=>{var P;const x=b==null||(P=b.originalResponse)==null?void 0:P.getStatus();if(x===429){if(!this.requests.isPaused){var j;const k=(j=Ze(this,Gt)[Gt])==null?void 0:j.next();if(k==null||k.done)return!1;this.requests.rateLimit(k.value)}}else{if(x!=null&&x>400&&x<500&&x!==409&&x!==423)return!1;typeof navigator<"u"&&navigator.onLine===!1&&(this.requests.isPaused||(this.requests.pause(),window.addEventListener("online",()=>{this.requests.resume()},{once:!0})))}return n.abort(),n={shouldBeRequeued:!0,abort(){this.shouldBeRequeued=!1},done(){throw new Error("Cannot mark a queued request as done: this indicates a bug")},fn(){throw new Error("Cannot run a queued request: this indicates a bug")}},!0};a!=null?f.onShouldRetry=(b,P)=>a(b,P,s,p):f.onShouldRetry=p;const v=(b,P,x)=>{zt(b,P)&&!zt(b,x)&&(b[x]=b[P])},w={};Br(s.allowedMetaFields,t.meta).forEach(b=>{w[b]=String(t.meta[b])}),v(w,"type","filetype"),v(w,"name","filename"),f.metadata=w,o=new Iu(t.data,f),this.uploaders[t.id]=o;const O=new Si(this.uppy);this.uploaderEvents[t.id]=O,i=()=>(t.isPaused||o.start(),()=>{}),o.findPreviousUploads().then(b=>{const P=b[0];P&&(this.uppy.log(`[Tus] Resuming upload of ${t.id} started at ${P.creationTime}`),o.resumeFromPreviousUpload(P))}),n=this.requests.run(i),O.onFileRemove(t.id,b=>{n.abort(),this.resetUploaderReferences(t.id,{abort:!!o.url}),e(`upload ${b} was removed`)}),O.onPause(t.id,b=>{n.abort(),b?o.abort():n=this.requests.run(i)}),O.onPauseAll(t.id,()=>{n.abort(),o.abort()}),O.onCancelAll(t.id,()=>{n.abort(),this.resetUploaderReferences(t.id,{abort:!!o.url}),e(`upload ${t.id} was canceled`)}),O.onResumeAll(t.id,()=>{n.abort(),t.error&&o.abort(),n=this.requests.run(i)})}).catch(e=>{throw this.uppy.emit("upload-error",t,e),e})}function Ku(t){var e;const r={...this.opts};return t.tus&&Object.assign(r,t.tus),typeof r.headers=="function"&&(r.headers=r.headers(t)),{...(e=t.remote)==null?void 0:e.body,endpoint:r.endpoint,uploadUrl:r.uploadUrl,protocol:"tus",size:t.data.size,headers:r.headers,metadata:t.meta}}async function Wu(t){const e=Ui(t),r=Ei(e);this.uppy.emit("upload-start",r),await Promise.allSettled(e.map(n=>{if(n.isRemote){const i=()=>this.requests,o=new AbortController,s=l=>{l.id===n.id&&o.abort()};this.uppy.on("file-removed",s);const a=this.uppy.getRequestClientForFile(n).uploadRemoteFile(n,Ze(this,tn)[tn](n),{signal:o.signal,getQueue:i});return this.requests.wrapSyncFunction(()=>{this.uppy.off("file-removed",s)},{priority:-1})(),a}return Ze(this,en)[en](n)}))}eo.VERSION=Hu.version;function fn(t,e,r,n,i,o,s,a){var l=typeof t=="function"?t.options:t;e&&(l.render=e,l.staticRenderFns=r,l._compiled=!0),n&&(l.functional=!0),o&&(l._scopeId="data-v-"+o);var c;if(s?(c=function(v){v=v||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!v&&typeof __VUE_SSR_CONTEXT__<"u"&&(v=__VUE_SSR_CONTEXT__),i&&i.call(this,v),v&&v._registeredComponents&&v._registeredComponents.add(s)},l._ssrRegister=c):i&&(c=a?function(){i.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:i),c)if(l.functional){l._injectStyles=c;var f=l.render;l.render=function(w,U){return c.call(U),f(w,U)}}else{var p=l.beforeCreate;l.beforeCreate=p?[].concat(p,c):[c]}return{exports:t,options:l}}const Xu={props:{container:String,file:Object},data(){return{loading:!0,saving:!1,blueprint:{},values:{},meta:{},errors:{}}},mounted(){this.load()},methods:{load(){this.loading=!0;const t=cp_url(`large-assets/api/assets?container=${this.container}`);this.$axios.get(t).then(e=>{this.blueprint=e.data.blueprint,this.values=e.data.values,this.meta=e.data.meta,this.loading=!1})},save(){this.saving=!0;const t=cp_url(`large-assets/api/assets?container=${this.container}`);this.$axios.post(t,{values:this.values}).then(e=>{this.saving=!1,this.$emit("saved",e.data.values)}).catch(e=>{if(this.saving=!1,e.response&&e.response.status===422){const{message:r,errors:n}=e.response.data;this.error=r,this.errors=n,this.$toast.error(r)}else e.response?this.$toast.error(e.response.data.message):this.$toast.error(__("Something went wrong"))})}}};var Vu=function(){var e=this,r=e._self._c;return r("modal",{attrs:{width:"600px"},on:{closed:function(n){return e.$emit("closed")}},scopedSlots:e._u([{key:"default",fn:function({close:n}){return r("div",{},[r("header",{staticClass:"text-lg font-semibold px-5 py-3 bg-gray-200 dark:bg-dark-550 rounded-t-lg flex items-center justify-between border-b dark:border-dark-900"},[e._v(" "+e._s(e.__("Upload File"))+" ")]),r("div",{staticClass:"flex-1 px-5 py-6 text-gray dark:text-dark-150"},[e.loading?r("div",{staticClass:"text-center"},[r("loading-graphic",{attrs:{text:null}})],1):r("div",[r("publish-container",{attrs:{name:"asset",blueprint:e.blueprint,values:e.values,meta:e.meta,errors:e.errors},on:{updated:function(i){e.values=i}},scopedSlots:e._u([{key:"default",fn:function({setFieldValue:i,setFieldMeta:o}){return r("div",{},[r("publish-sections",{attrs:{sections:e.blueprint.tabs[0].sections},on:{updated:i,"meta-updated":o}})],1)}}],null,!0)})],1)]),r("div",{staticClass:"px-5 py-3 bg-gray-200 dark:bg-dark-550 rounded-b-lg border-t dark:border-dark-900 flex items-center justify-end text-sm"},[r("button",{staticClass:"btn",domProps:{textContent:e._s(e.__("Cancel"))},on:{click:n}}),r("button",{staticClass:"btn-primary rtl:mr-4 ltr:ml-4",attrs:{disabled:e.loading},domProps:{textContent:e._s(e.__("Upload"))},on:{click:e.save}})])])}}])})},Yu=[],Ju=fn(Xu,Vu,Yu,!1,null,null,null,null);const Qu=Ju.exports,Zu={components:{Form:Qu},props:{enabled:{type:Boolean,default:()=>!0},container:String,path:String,uppy:null},data(){return{initialized:!1,config:null,meta:null,dragging:!1,uploads:[],showForm:!1,file:null,values:{}}},watch:{uploads(t){this.$emit("updated",t)}},computed:{shouldShowForm(){return this.config.show_form}},methods:{initialize(t,e){this.config=t,this.meta=e,this.initializeUppy(),this.meta.driver==="s3"?this.initializeUppyS3():this.initializeUppyTus(),this.initialized=!0},initializeUppy(){this.uppy=new Xs({id:uniqid(),autoProceed:!0}),this.uppy.on("upload",(t,e)=>{e.forEach(r=>{this.uploads.push({id:r.id,basename:r.name,extension:r.extension,percent:0,errorMessage:null})})}),this.uppy.on("upload-progress",(t,e)=>{this.handleUploadProgress(t.id,e.bytesUploaded/e.bytesTotal)}),this.uppy.on("upload-error",(t,e)=>{this.handleUploadError(t.id,e.response.status,e.response.data)}),this.uppy.on("complete",()=>{this.file=null,this.values={}})},initializeUppyTus(){const t="large-assets/api/upload-tus";this.uppy.use(eo,{endpoint:cp_url(`${t}/endpoint`),chunkSize:Statamic.$config.get("large_assets.tus.chunk_size"),headers:{"X-CSRF-TOKEN":Statamic.$config.get("csrfToken")}}),this.uppy.on("upload-success",async(e,r)=>{const n=cp_url(`${t}/complete`);try{const i=await this.$axios.post(n,{container:this.container,folder:this.path,uploadUrl:r.uploadURL,values:this.values});this.handleUploadSuccess(e.id,i.data)}catch(i){this.handleUploadError(e.id,i.response.status,i.response.data)}})},initializeUppyS3(){const t="large-assets/api/upload-s3";this.uppy.use(gr,{chunkSize:Statamic.$config.get("large_assets.s3.chunk_size"),autoProceed:!0,shouldUseMultipart:!0,createMultipartUpload:async(e,r)=>{r==null||r.throwIfAborted();const n=cp_url(`${t}/create`);return(await this.$axios.post(n,{container:this.container,folder:this.path,key:e.name})).data},signPart:async(e,{uploadId:r,key:n,partNumber:i,signal:o})=>{o==null||o.throwIfAborted();const s=cp_url(`${t}/sign-part`);return(await this.$axios.post(s,{container:this.container,key:n,uploadId:r,partNumber:i})).data},completeMultipartUpload:async(e,{key:r,uploadId:n,parts:i},o)=>{o==null||o.throwIfAborted();const s=cp_url(`${t}/complete`);return(await this.$axios.post(s,{container:this.container,key:r,uploadId:n,parts:i,values:this.values})).data},listParts:async(e,{key:r,uploadId:n},i)=>{i==null||i.throwIfAborted();const o=cp_url(`${t}/list-parts`);return(await this.$axios.post(o,{container:this.container,key:r,uploadId:n})).data},abortMultipartUpload:async(e,{key:r,uploadId:n})=>{const i=cp_url(`${t}/abort`);await this.$axios.post(i,{container:this.container,key:r,uploadId:n})}}),this.uppy.on("upload-success",(e,r)=>{this.handleUploadSuccess(e.id,r.body)})},browse(){this.$refs.input.click()},select(t){this.addFiles(Array.from(t.target.files))},dragenter(t){t.stopPropagation(),t.preventDefault(),this.dragging=!0},dragover(t){t.stopPropagation(),t.preventDefault()},dragleave(t){t.target===t.currentTarget&&(this.dragging=!1)},drop(t){t.stopPropagation(),t.preventDefault(),this.dragging=!1,this.addFiles(Array.from(t.dataTransfer.files))},addFiles(t){this.shouldShowForm?this.addFile(t[0]):t.forEach(e=>this.addFile(e))},addFile(t){this.enabled&&(this.shouldShowForm?this.openForm(t):this.uppy.addFile(t))},openForm(t){this.file=t,this.showForm=!0},closeForm(){this.file=null,this.showForm=!1},saveForm(t){this.values=t,this.uppy.addFile(this.file),this.showForm=!1},findUpload(t){return this.uploads.find(e=>e.id===t)},findUploadIndex(t){return this.uploads.findIndex(e=>e.id===t)},handleUploadProgress(t,e){this.findUpload(t).percent=e*100},handleUploadSuccess(t,e){this.$emit("upload-complete",e.data),this.uploads.splice(this.findUploadIndex(t),1)},handleUploadError(t,e,r){const n=this.findUpload(t);let i=r.message;i||(i=e),n.errorMessage=i,this.$emit("error",n,this.uploads)}}};var ec=function(){var e=this,r=e._self._c;return r("div",[e.initialized?r("div",{on:{dragenter:e.dragenter,dragover:e.dragover,dragleave:e.dragleave,drop:e.drop}},[r("div",{class:{"pointer-events-none":e.dragging}},[r("input",{ref:"input",staticClass:"hidden",attrs:{type:"file",multiple:!e.shouldShowForm},on:{input:e.select}}),e._t("default",null,{dragging:e.enabled?e.dragging:!1})],2)]):e._e(),e.showForm?r("Form",{attrs:{container:e.container,file:e.file},on:{closed:e.closeForm,saved:e.saveForm}}):e._e()],1)},tc=[],rc=fn(Zu,ec,tc,!1,null,null,null,null);const nc=rc.exports,ic={extends:Vue.component("assets-fieldtype"),components:{Uploader:nc},mounted(){this.$el.closest(".large_assets-fieldtype").classList.add("assets-fieldtype"),this.$refs.uploader.initialize(this.config,this.meta)}},oc=null,sc=null;var ac=fn(ic,oc,sc,!1,null,null,null,null);const lc=ac.exports;Statamic.booting(()=>{Statamic.component("large_assets-fieldtype",lc)});
